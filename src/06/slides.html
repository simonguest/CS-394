<!DOCTYPE html>
<html lang="en"><head>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/tabby.min.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-597958c53c93a607afca12fd375c57ed.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.8.26">

  <title>CS-394 – Module 6: Increasing Model Accuracy (Part 1)</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #24292e;  }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #24292e; } /* Normal */
    code span.al { color: #ff5555; font-weight: bold; } /* Alert */
    code span.an { color: #6a737d; } /* Annotation */
    code span.at { color: #d73a49; } /* Attribute */
    code span.bn { color: #005cc5; } /* BaseN */
    code span.bu { color: #d73a49; } /* BuiltIn */
    code span.cf { color: #d73a49; } /* ControlFlow */
    code span.ch { color: #032f62; } /* Char */
    code span.cn { color: #005cc5; } /* Constant */
    code span.co { color: #6a737d; } /* Comment */
    code span.cv { color: #6a737d; } /* CommentVar */
    code span.do { color: #6a737d; } /* Documentation */
    code span.dt { color: #d73a49; } /* DataType */
    code span.dv { color: #005cc5; } /* DecVal */
    code span.er { color: #ff5555; text-decoration: underline; } /* Error */
    code span.ex { color: #d73a49; font-weight: bold; } /* Extension */
    code span.fl { color: #005cc5; } /* Float */
    code span.fu { color: #6f42c1; } /* Function */
    code span.im { color: #032f62; } /* Import */
    code span.in { color: #6a737d; } /* Information */
    code span.kw { color: #d73a49; } /* Keyword */
    code span.op { color: #24292e; } /* Operator */
    code span.ot { color: #6f42c1; } /* Other */
    code span.pp { color: #d73a49; } /* Preprocessor */
    code span.re { color: #6a737d; } /* RegionMarker */
    code span.sc { color: #005cc5; } /* SpecialChar */
    code span.ss { color: #032f62; } /* SpecialString */
    code span.st { color: #032f62; } /* String */
    code span.va { color: #e36209; } /* Variable */
    code span.vs { color: #032f62; } /* VerbatimString */
    code span.wa { color: #ff5555; } /* Warning */
    /* CSS for citations */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
      margin-bottom: 0em;
    }
    .hanging-indent div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }  </style>
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/theme/quarto-eeafb82a00776dbd0312b01cd21cfa25.css">
  <link href="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Module 6: Increasing Model Accuracy (Part 1)</h1>

<div class="quarto-title-authors">
</div>

</section>
<section id="recap" class="slide level2">
<h2>Recap</h2>
<ul>
<li class="fragment">Understood the use cases, advantages/disadvantages for running models on local hardware - desktop, web, mobile</li>
<li class="fragment">Understood hardware requirements and architectures for model inference - e.g., CUDA vs.&nbsp;ONNX vs.&nbsp;MLX vs.&nbsp;WebGPU</li>
<li class="fragment">Explored how quantization works and understood techniques and formats for quantizing existing models</li>
<li class="fragment">Used llama.cpp to quantize and run an SLM on local hardware/gaming PC</li>
<li class="fragment">Integrated a quantized model within Unity/Unreal/WebAssembly</li>
</ul>
</section>
<section id="lesson-objectives" class="slide level2">
<h2>Lesson Objectives</h2>
<ul>
<li class="fragment">Understand model training, dataset curation, what leads to hallucinations in models, how models are evaluated, and an overview of techniques to increase accuracy</li>
<li class="fragment">Explore use cases, advantages, and disadvantages of prompt engineering</li>
<li class="fragment">Introduce and implement RAG (Retrieval-Augmented Generation) to increase the accuracy of a limited SLM</li>
<li class="fragment">Start exploring how to fine-tune models</li>
<li class="fragment">Generate synthetic data for fine-tuning a small language model</li>
</ul>
</section>
<section>
<section id="hallucinations" class="title-slide slide level1 center">
<h1>Hallucinations</h1>

</section>
<section id="hallucinations-1" class="slide level2">
<h2>Hallucinations</h2>
<ul>
<li class="fragment">Breaking News: Models hallucinate!
<ul>
<li class="fragment">Especially noticeable on older and smaller models</li>
<li class="fragment">Many hallucinations can be difficult to spot as they sound so plausible</li>
<li class="fragment">Plausible sounding requests (i.e., asking about something that doesn’t exist) often result in a hallucination</li>
</ul></li>
</ul>
</section>
<section id="hallucinations-2" class="slide level2">
<h2>Hallucinations</h2>
<div class="quarto-embed-nb-cell" data-notebook="/home/runner/work/CS-394/CS-394/src/06/notebooks/hallucinations.ipynb" data-notebook-title="Hallucinations" data-notebook-cellid="setup-client">
<div id="setup-client" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a></a>MODEL <span class="op">=</span> <span class="st">"meta-llama/llama-3.2-1b-instruct"</span></span>
<span id="cb1-2"><a></a></span>
<span id="cb1-3"><a></a><span class="im">import</span> openai</span>
<span id="cb1-4"><a></a></span>
<span id="cb1-5"><a></a>client <span class="op">=</span> openai.OpenAI(</span>
<span id="cb1-6"><a></a>    base_url<span class="op">=</span><span class="st">'https://openrouter.ai/api/v1'</span>,</span>
<span id="cb1-7"><a></a>    api_key<span class="op">=</span>os.environ[<span class="st">"OPENROUTER_API_KEY"</span>],</span>
<span id="cb1-8"><a></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</section>
<section id="hallucinations-citations" class="slide level2">
<h2>Hallucinations: Citations</h2>
<div class="quarto-embed-nb-cell" data-notebook="/home/runner/work/CS-394/CS-394/src/06/notebooks/hallucinations.ipynb" data-notebook-title="Hallucinations" data-notebook-cellid="hallucinate-1">
<div id="hallucinate-1" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a></a>response <span class="op">=</span> client.chat.completions.create(</span>
<span id="cb2-2"><a></a>    model<span class="op">=</span>MODEL,</span>
<span id="cb2-3"><a></a>    messages<span class="op">=</span>[</span>
<span id="cb2-4"><a></a>        {<span class="st">"role"</span>: <span class="st">"system"</span>, <span class="st">"content"</span>: <span class="st">"You help students generate citations for their coursework."</span>},</span>
<span id="cb2-5"><a></a>        {<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: <span class="st">"Can you cite three academic papers on transfomer efficiency. I'm looking for the author names, journals, years, and titles."</span>},</span>
<span id="cb2-6"><a></a>    ],</span>
<span id="cb2-7"><a></a>)</span>
<span id="cb2-8"><a></a>response.choices[<span class="dv">0</span>].message.content</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</section>
<section id="hallucinations-citations-1" class="slide level2">
<h2>Hallucinations: Citations</h2>
<div class="quarto-embed-nb-cell" data-notebook="/home/runner/work/CS-394/CS-394/src/06/notebooks/hallucinations.ipynb" data-notebook-title="Hallucinations" data-notebook-cellid="hallucinate-1">
<div id="hallucinate-1" class="cell" data-execution_count="8">
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>'Here are three academic papers on transformer efficiency:\n\n1. **"Attention is a Limited Resource: The Case for Unique Attention Mechanisms in Deep Neural Networks"**\n\nAuthor: Vaswani et al.\n\nJournal: Nature\n\nYear: 2017\n\nTitle: Attention is a Limited Resource: The Case for Unique Attention Mechanisms in Deep Neural Networks\n\nThis paper proposes a new approach to attention mechanisms in deep neural networks, which suggests that attention is not just a simple linear scaling of the input features, but rather a complex mechanism that involves multiple stages and attention weights. The authors demonstrate that this approach can improve the performance of deep neural networks on various tasks.\n\n2. **"Attention is All You Need"**\n\nAuthor: Vaswani et al.\n\nJournal: Nature\n\nYear: 2017\n\nTitle: Attention is All You Need\n\nThis paper presents a new approach to attention mechanisms in deep neural networks, which suggests that attention is not just a simple linear scaling of the input features, but rather a complex mechanism that involves multiple stages and attention weights. The authors demonstrate that this approach can improve the performance of deep neural networks on various tasks.\n\n3. **"Attention is a Key to Efficient Neural Network Training"**\n\nAuthor: He et al.\n\nJournal: Proceedings of the 32nd International Conference on Machine Learning (ICML)\n\nYear: 2015\n\nTitle: Attention is a Key to Efficient Neural Network Training\n\nThis paper presents a new approach to attention mechanisms in deep neural networks, which suggests that attention is a key factor in improving the efficiency of neural network training. The authors demonstrate that attention mechanisms can significantly improve the training speed and accuracy of deep neural networks on various tasks.\n\nNote: These papers are just a few examples of the many papers that have explored transformer efficiency.'</code></pre>
</div>
</div>
</div>
</section>
<section id="hallucinations-local-knowledge" class="slide level2">
<h2>Hallucinations: Local Knowledge</h2>
<div class="quarto-embed-nb-cell" data-notebook="/home/runner/work/CS-394/CS-394/src/06/notebooks/hallucinations.ipynb" data-notebook-title="Hallucinations" data-notebook-cellid="hallucinate-2">
<div id="hallucinate-2" class="cell" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a></a>response <span class="op">=</span> client.chat.completions.create(</span>
<span id="cb4-2"><a></a>    model<span class="op">=</span>MODEL,</span>
<span id="cb4-3"><a></a>    messages<span class="op">=</span>[</span>
<span id="cb4-4"><a></a>        {<span class="st">"role"</span>: <span class="st">"system"</span>, <span class="st">"content"</span>: <span class="st">"You help provide information about software applications."</span>},</span>
<span id="cb4-5"><a></a>        {<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: <span class="st">"Tell me more about FilterGenie, software for the Mac that allows you to apply dynamic filters to images."</span>},</span>
<span id="cb4-6"><a></a>    ],</span>
<span id="cb4-7"><a></a>)</span>
<span id="cb4-8"><a></a>response.choices[<span class="dv">0</span>].message.content</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</section>
<section id="hallucinations-local-knowledge-1" class="slide level2">
<h2>Hallucinations: Local Knowledge</h2>
<div class="quarto-embed-nb-cell" data-notebook="/home/runner/work/CS-394/CS-394/src/06/notebooks/hallucinations.ipynb" data-notebook-title="Hallucinations" data-notebook-cellid="hallucinate-2">
<div id="hallucinate-2" class="cell" data-execution_count="13">
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>"FilterGenie is a powerful image editing software for Mac that allows you to apply dynamic filters to images. It's a popular tool among photographers, graphic designers, and anyone looking to enhance and transform their images with ease.\n\nHere are some key features and benefits of FilterGenie:\n\n**Key Features:**\n\n1. **Dynamic Filters**: FilterGenie offers a wide range of dynamic filters that can be applied to images, including:\n\t* Color correction and adjustment\n\t* Noise reduction and sharpening\n\t* Texture and pattern overlays\n\t* Effects like blur, vignette, and glow\n\t* And many more!\n2. **Adjustable Parameters**: Each filter has adjustable parameters, allowing you to fine-tune the effect to your liking.\n3. **Support for Multiple Image Files**: FilterGenie supports a wide range of image file formats, including JPEG, PNG, and TIFF.\n4. **Batch Processing**: You can apply filters to multiple images at once, making it a great tool for editing multiple images in a single session.\n5. **Export Options**: FilterGenie allows you to export your edited images in various formats, including JPEG, PNG, and PSD.\n\n**Benefits:**\n\n1. **Easy to Use**: FilterGenie's intuitive interface makes it easy to apply filters to images, even for those without extensive image editing experience.\n2. **Versatile**: The software offers a wide range of filters to suit various image editing needs, from basic adjustments to more advanced effects.\n3. **High-Quality Results**: FilterGenie's filters are designed to produce high-quality results, ensuring your images look professional and polished.\n4. **Cross-Platform Compatibility**: FilterGenie is available for Mac, Windows, and Linux, making it a great option for users with multiple operating systems.\n\n**System Requirements:**\n\nTo run FilterGenie, you'll need:\n\n* Mac with macOS 10.12 or later\n* 2 GB RAM or more\n* 2 GB free disk space\n* A compatible graphics card (Intel Core i5 or later recommended)\n\n**Pricing:**\n\nFilterGenie offers a free trial version, as well as a one-time purchase option for the full version. The full version costs around $49.99 USD.\n\nOverall, FilterGenie is a powerful and versatile image editing software that's perfect for anyone looking to enhance and transform their images with dynamic filters."</code></pre>
</div>
</div>
</div>
</section>
<section id="hallucinations-summarization" class="slide level2">
<h2>Hallucinations: Summarization</h2>
<div class="quarto-embed-nb-cell" data-notebook="/home/runner/work/CS-394/CS-394/src/06/notebooks/hallucinations.ipynb" data-notebook-title="Hallucinations" data-notebook-cellid="hallucinate-3">
<div id="hallucinate-3" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a></a>response <span class="op">=</span> client.chat.completions.create(</span>
<span id="cb6-2"><a></a>    model<span class="op">=</span>MODEL,</span>
<span id="cb6-3"><a></a>    messages<span class="op">=</span>[</span>
<span id="cb6-4"><a></a>        {<span class="st">"role"</span>: <span class="st">"system"</span>, <span class="st">"content"</span>: <span class="st">"You help users summarize documents and published papers."</span>},</span>
<span id="cb6-5"><a></a>        {<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: <span class="st">"Can you summarize the key findings of the 2019 WHO report on urban air quality in South Asia."</span>},</span>
<span id="cb6-6"><a></a>    ],</span>
<span id="cb6-7"><a></a>)</span>
<span id="cb6-8"><a></a>response.choices[<span class="dv">0</span>].message.content</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</section>
<section id="hallucinations-summarization-1" class="slide level2">
<h2>Hallucinations: Summarization</h2>
<div class="quarto-embed-nb-cell" data-notebook="/home/runner/work/CS-394/CS-394/src/06/notebooks/hallucinations.ipynb" data-notebook-title="Hallucinations" data-notebook-cellid="hallucinate-3">
<div id="hallucinate-3" class="cell">
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>"I couldn't find a specific 2019 WHO report on urban air quality in South Asia. However, I can provide some general information on the topic and highlight some key findings from previous reports.\n\nThe World Health Organization (WHO) has published several reports on air quality in South Asia, including:\n\n1. **2018 WHO Air Quality Guidelines**: In 2018, WHO published guidelines for air quality in urban areas, which emphasized the importance of reducing air pollution from domestic and industrial sources. The guidelines recommended that cities implement measures to reduce particulate matter (PM2.5) and other pollutants.\n2. **2019 WHO Air Quality Report**: In 2019, WHO published a report on air quality in South Asia, which highlighted the region's vulnerability to air pollution. The report noted that South Asia is home to some of the world's most populous cities, including Delhi, Mumbai, and Dhaka, which are among the most polluted cities in the world.\n3. **2019 WHO Air Quality Report: South Asia**: This report focused on the health impacts of air pollution in South Asia, including the estimated number of premature deaths and hospitalizations due to air pollution. The report also highlighted the need for cities to implement effective air quality management strategies to reduce pollution.\n\nSome key findings from these reports include:\n\n* **Air pollution is a major public health concern in South Asia**: The region is home to some of the world's most polluted cities, with PM2.5 levels exceeding the WHO's recommended limits in many areas.\n* **Air pollution affects vulnerable populations**: The report highlighted the disproportionate impact of air pollution on vulnerable populations, including children, the elderly, and people with pre-existing respiratory conditions.\n* **Air pollution is linked to increased mortality**: The report estimated that air pollution is responsible for an estimated 1.8 million premature deaths per year in South Asia, primarily due to respiratory diseases such as bronchitis and lung cancer.\n* **Air pollution affects economic productivity**: The report noted that air pollution can have significant economic impacts, including reduced economic productivity and increased healthcare costs.\n\nSome specific data points from the 2019 WHO Air Quality Report include:\n\n* Delhi, India: PM2.5 levels exceeded the WHO's recommended limit in 2019, with an average annual concentration of 44.4 μg/m3.\n* Mumbai, India: PM2.5 levels exceeded the WHO's recommended limit in 2019, with an average annual concentration of 35.4 μg/m3.\n* Dhaka, Bangladesh: PM2.5 levels exceeded the WHO's recommended limit in 2019, with an average annual concentration of 23.4 μg/m3.\n\nOverall, the 2019 WHO Air Quality Report highlights the urgent need for cities in South Asia to take action to reduce air pollution and protect public health."</code></pre>
</div>
</div>
</div>
</section>
<section id="why-do-models-hallucinate" class="slide level2">
<h2>Why Do Models Hallucinate?</h2>
<ul>
<li class="fragment">A language model is not a database
<ul>
<li class="fragment">It’s a stochastic prediction machine</li>
<li class="fragment">Models often don’t know how to say “I don’t know”</li>
<li class="fragment">Instead, they are designed to come up with the most plausible continuation, not to retrieve verified facts</li>
<li class="fragment">(Hallucination isn’t a bug in the traditional sense)</li>
</ul></li>
</ul>
</section>
<section id="why-do-models-hallucinate-1" class="slide level2">
<h2>Why Do Models Hallucinate?</h2>
<ul>
<li class="fragment">Models are trained on a large corpus of Internet data
<ul>
<li class="fragment">Data on the Internet is often uneven</li>
<li class="fragment">Full of gaps</li>
<li class="fragment">Often contradictory</li>
</ul></li>
</ul>
</section>
<section id="why-do-models-hallucinate-2" class="slide level2">
<h2>Why Do Models Hallucinate?</h2>
<ul>
<li class="fragment">Model size vs.&nbsp;Training set size
<ul>
<li class="fragment">Many of the latest models hold billions of parameters</li>
<li class="fragment">But they are trained on trillions of tokens</li>
<li class="fragment">Thus, they can’t memorize everything and instead recognize patterns to recall information</li>
</ul></li>
</ul>
</section></section>
<section>
<section id="model-accuracy" class="title-slide slide level1 center">
<h1>Model Accuracy</h1>

</section>
<section id="model-accuracy-1" class="slide level2">
<h2>Model Accuracy</h2>
<ul>
<li class="fragment">Fortunately, we can improve the accuracy of models using several techniques:
<ul>
<li class="fragment">Prompt Engineering</li>
<li class="fragment">Reasoning/Thinking Models</li>
<li class="fragment">Context Injection</li>
<li class="fragment">Fine-tuning</li>
</ul></li>
</ul>
</section></section>
<section>
<section id="prompt-engineering" class="title-slide slide level1 center">
<h1>Prompt Engineering</h1>

</section>
<section id="prompt-engineering-1" class="slide level2">
<h2>Prompt Engineering</h2>
<ul>
<li class="fragment">Best practices (introduced in Module 2)
<ul>
<li class="fragment"><strong>Be specific</strong>: <em>“You are a Python programming tutor who explains concepts using simple analogies and provides code examples.”</em></li>
<li class="fragment"><strong>Define output</strong>: <em>“List no more than 3 suggestions. Always show your work step by step.”</em></li>
<li class="fragment"><strong>Set boundaries</strong>: <em>“If you are asked questions outside coding, politely redirect the student back to the task.”</em></li>
</ul></li>
</ul>
</section>
<section id="prompt-engineering-2" class="slide level2">
<h2>Prompt Engineering</h2>
<ul>
<li class="fragment">Output-formatting examples:
<ul>
<li class="fragment">Providing 2-5 examples of desired output can dramatically improve performance</li>
<li class="fragment"><em>“Please provide your output as…”</em></li>
<li class="fragment"><em>“Format your answer in the following way…”</em></li>
<li class="fragment">(Of course, structured outputs, if it’s available, can be more reliable)</li>
</ul></li>
</ul>
</section>
<section id="prompt-engineering-3" class="slide level2">
<h2>Prompt Engineering</h2>
<ul>
<li class="fragment">Few-shot examples:
<ul>
<li class="fragment">Providing 2-5 examples of input/output pairs dramatically improves performance</li>
<li class="fragment">Example: <em>“Q: What’s 15% of 80? A: Let me calculate: 80 × 0.15 = 12”</em></li>
<li class="fragment">Especially effective for formatting, tone, or structure-heavy tasks</li>
</ul></li>
</ul>
</section>
<section id="prompt-engineering-4" class="slide level2">
<h2>Prompt Engineering</h2>
<ul>
<li class="fragment">Role/persona assignment:
<ul>
<li class="fragment">It is common to add a role/persona to help guide the model</li>
<li class="fragment"><em>“You are a senior engineer reviewing code for a junior developer”</em></li>
<li class="fragment"><em>“You are a geography teacher working with high school students”</em></li>
</ul></li>
</ul>
</section>
<section id="prompt-engineering-5" class="slide level2">
<h2>Prompt Engineering</h2>
<ul>
<li class="fragment">Negative samples:
<ul>
<li class="fragment">Showing what not to do alongside positive examples</li>
<li class="fragment"><em>“Do not add ```python markdown code fences before generating code”</em></li>
</ul></li>
<li class="fragment">Chain-of-Thought:
<ul>
<li class="fragment">Explicitly asking the model to “think step-by-step”</li>
<li class="fragment">Which introduces our next technique: reasoning/thinking models</li>
</ul></li>
</ul>
</section></section>
<section>
<section id="reasoningthinking-models" class="title-slide slide level1 center">
<h1>Reasoning/Thinking Models</h1>

</section>
<section id="reasoningthinking-models-1" class="slide level2">
<h2>Reasoning/Thinking Models</h2>
<ul>
<li class="fragment">In 2022, Google researchers showed that prompting models to think “step by step” dramatically improved performance on math and reasoning tasks.
<ul>
<li class="fragment">Paper: “Chain-of-Thought Prompting Elicits Reasoning in Large Language Models” <span class="citation" data-cites="wei2022chain">(<a href="#/references-1" role="doc-biblioref" onclick="">Wei et al. 2022</a>)</span></li>
<li class="fragment">This prompt engineering technique is known as “Chain-of-Thought”</li>
<li class="fragment">i.e., showing your work helped arrive at better answers</li>
</ul></li>
</ul>
</section>
<section id="reasoningthinking-models-2" class="slide level2">
<h2>Reasoning/Thinking Models</h2>
<ul>
<li class="fragment"><strong>2023:</strong> Models began to be trained with reinforcement learning on reasoning processes, not just final answers</li>
<li class="fragment"><strong>2024-25:</strong> OpenAI released o1 and o3 models. “Thinking tokens” are a separate hidden phase before generating visible output.</li>
<li class="fragment"><strong>Today:</strong> Thousands of models on Hugging Face, often suffixed with <strong>-Thinking</strong></li>
</ul>
</section>
<section id="reasoningthinking-models-3" class="slide level2">
<h2>Reasoning/Thinking Models</h2>
<ul>
<li class="fragment">How do reasoning/thinking models work?
<ul>
<li class="fragment">Models are fine-tuned to produce “thinking tokens” before their final answer</li>
<li class="fragment">The model learns to use the thinking phase as a “scratch space” where it can explore, self-correct, and reason</li>
<li class="fragment">Thinking tokens in open-weight models are often in-between <code>&lt;think&gt;</code> and <code>&lt;/think&gt;</code> tokens (or just a single <code>&lt;/think&gt;</code> token to divide the two)</li>
<li class="fragment">Thinking tokens for closed models (e.g., o1/o3) are typically hidden</li>
</ul></li>
</ul>
</section>
<section id="reasoningthinking-models-4" class="slide level2">
<h2>Reasoning/Thinking Models</h2>
<div class="quarto-embed-nb-cell" data-notebook="/home/runner/work/CS-394/CS-394/src/06/notebooks/thinking.ipynb" data-notebook-title="Using Qwen3-4B-Thinking" data-notebook-cellid="pipe">
<div id="pipe" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:696,&quot;referenced_widgets&quot;:[&quot;4f08bca706b04e5982bb87e206e0b294&quot;,&quot;e6ba57ae6584492dbf071bfd14a0fec4&quot;,&quot;69aba867b45b45beaf9f263679e1bba0&quot;,&quot;98a441d9504a45e9aeb2c81b70552e0f&quot;,&quot;7ea9159e0f464693a19de7a5cab34b49&quot;,&quot;4e6042da80d64092ac94b39ff12605be&quot;,&quot;27d8facaacd444098469119128d3d458&quot;,&quot;17d219b8401d432b9a84d403bfc8bbc8&quot;,&quot;06790b340e3a4063bf6d2cf0d86dd06c&quot;,&quot;6f1fe99d83ff4d7992c72eaa351ce039&quot;,&quot;00b678dd634f489c9655907891e52a6f&quot;,&quot;8073ffb8be77406684ee3655b939c84f&quot;,&quot;d09a7922c9984eea99f779b74e85cb85&quot;,&quot;90f8a4f3f6ff43ba90842fb59da7c8e5&quot;,&quot;e1a20575d63246768e7a135644af809a&quot;,&quot;c79fd11ad0f2410c95012399690d330b&quot;,&quot;98dc89247ef54e00888010e470d59618&quot;,&quot;ab6d8499f1cc4c4bab7ae21abdfc72b3&quot;,&quot;ac29745d5d4444f098bfabfc88b026e2&quot;,&quot;a3e37d9d8af84a629612f9e5eb53d7b6&quot;,&quot;6ebbb93344b548faa9ff4f98553ba7da&quot;,&quot;336ce1b014bc49959042305bb79d7ec9&quot;,&quot;e9a95ad9cd984480af581a67f1c99ddb&quot;,&quot;a800b0e3ec7b4791a3e025db5030168f&quot;,&quot;4e3a3e827375452c9c0ec4bc62430354&quot;,&quot;d5d34f9c2bba4428995767975f2cc65c&quot;,&quot;f20efdd74add4819a453c2ec95d6cae2&quot;,&quot;c9f29c3119cf4e0eb5924e1a049f8fe8&quot;,&quot;ed52af3550e74d27ac85c27bd1906add&quot;,&quot;f87bbdbbff9e48719e5c684a05c51ed9&quot;,&quot;68c4974498534dbebf0dd3aaf259c6d4&quot;,&quot;f5724c70ef474d9899d6fad10d000f68&quot;,&quot;47934e5a9258448b9640e0f16f465a3a&quot;,&quot;e930fb19f98247539631b12f5cfa0a22&quot;,&quot;51557de5fd8a41ab8c01267f9dee0acf&quot;,&quot;35028381674b43dda74389851570d185&quot;,&quot;1d062bf3b1c74e26b297d1dec9064886&quot;,&quot;60203337a9a84cc0803a27912679a67d&quot;,&quot;3b8cc2d4ce3d4886b874cb3b847f7553&quot;,&quot;bf25dfa00ad04ca8aa73f85ee4390f22&quot;,&quot;e9cb162d006f442798f152180a9476ee&quot;,&quot;1f9df553dab14ba69848e70a7149a344&quot;,&quot;1ad7806466644a73a326d6ea01a6c293&quot;,&quot;809e2af2b223495594b391d959c2632b&quot;,&quot;1ae7cdbf2d8944489efb0145e12345a1&quot;,&quot;084e05174f25459bb0693bc0a26bd4f1&quot;,&quot;02f52852a6d8465bb5ff7e1fec6b2880&quot;,&quot;75b6d0e4ab9b4d5386e5c5d3d2c6497b&quot;,&quot;d02ae752a77146ed9ccb78c156889762&quot;,&quot;36f3ce28dcb1466ebeeb42dfbbfd006d&quot;,&quot;5762d7ad3f1e49eab42461575d91dc2f&quot;,&quot;3f95507436504c1da056a4428e0c3632&quot;,&quot;251c65384c5b4ea79b7e9876ca388918&quot;,&quot;669042ebc16448028db9a7fb7e6ff623&quot;,&quot;226962e49c714e03a07d6b5836947703&quot;,&quot;49f7d88482314815989f583b8b7d344a&quot;,&quot;ad965825b8d94fd5b34acd8b2f657393&quot;,&quot;6e02c509d2fa4223b83d1b9fee4d71d0&quot;,&quot;713f0b22d8984aa89493c3ccd34e227b&quot;,&quot;449ad66fa420401f9ca1541bc420f43b&quot;,&quot;856f2c5ad6a94cbfb2478462e37bc57c&quot;,&quot;9a74ce284d264d5984289bd1d836b68f&quot;,&quot;d482846dfc3140a48bf34f9428132d00&quot;,&quot;7c7b85fa053a42649ef4a82f25d2e3da&quot;,&quot;0a3e880a48bb4834a6cf63c0210c1245&quot;,&quot;6996a95fbb1b43578eea12fd81a3937c&quot;,&quot;d5545e5b5968460990fd9c88d3a71a9f&quot;,&quot;94bb86be73f34e02b932d0cc3195dd2d&quot;,&quot;ca2ea336f9f24526a8c723ffc202a034&quot;,&quot;f56f36189ccb483faea2c67c713962c4&quot;,&quot;990d87134263470dbbc264a001ab7b1d&quot;,&quot;81c06bc2fac34fab903e3468b25c7007&quot;,&quot;7378cefca92f48e4a086990bd6085ca1&quot;,&quot;4e86813974004f6b8e2b18f45dbd48d7&quot;,&quot;100f8ecb08434534b51f715c5f5005bd&quot;,&quot;c5c89ace9e4c44048073e84bcd5c19f6&quot;,&quot;f5c754c03d984147868ec7eaa6392859&quot;,&quot;c076c97c1aa74fa3ae90e0c23d1ea89a&quot;,&quot;8454c7622ced4d4db954b528beaa2692&quot;,&quot;b2f310d4a50d482db57a342fa51dc4bd&quot;,&quot;b7a09db6dadc4f3aa6799d62f1286d64&quot;,&quot;a5c48c43984c4177a7da5dad35d96035&quot;,&quot;d4f5fba2fee24811b6694a23d412d63a&quot;,&quot;0ec5f8c58fb640cc92cd1f6dcd4a0537&quot;,&quot;51240554420f417db5fef67ea88cc115&quot;,&quot;d029a2790ca447459b8e594ff27a673c&quot;,&quot;a1c4333ea1e4406e814dd6577ad48151&quot;,&quot;95aa7bd4d54b4c87b1a09ddd5c497c1f&quot;,&quot;f32ecfa432bf4ed9b85c50d20858b00d&quot;,&quot;90527a1bd2b24a24989ecd5763497257&quot;,&quot;9e41c4229677416db89a2220d98063e1&quot;,&quot;f7a7526a30bc49bca6590bce2e1c8aba&quot;,&quot;305194de5e104d1792777c17653387fe&quot;,&quot;afe889ae4e2547dba5a2766c0c1a63ae&quot;,&quot;2130b04324574e9d9767fc0064061dc2&quot;,&quot;67de46a6207144c3ace07eafafd4231d&quot;,&quot;84bfa21bff1e4560aa56bf7f34f9341a&quot;,&quot;3a43fb018d504d149ff82c4e61ef734f&quot;,&quot;2456ae3504f64429bc823f12ba8ef456&quot;,&quot;dd15051b65cd490283b53720ce439e7b&quot;,&quot;bcb56edab0d5493ba7c3d86adc1c0213&quot;,&quot;fe71f531c6c644bf9f21e2e03b00a671&quot;,&quot;cfb3ad7209df490fa486eac5b57b6170&quot;,&quot;df048375242a41a4a142e750cdf0ad54&quot;,&quot;39dddcc816ad4baf9f42f16c04ce0fee&quot;,&quot;16d1067bf4ac4b3abe5f4a84e1283b82&quot;,&quot;282d061971d5418a8b1bdbd80c0910c8&quot;,&quot;cc63cc66f91642dfb32efd591f563033&quot;,&quot;cd33575e9b4043058a99325a357ec288&quot;,&quot;4879653c259f4e68bbfb4c25203977c9&quot;]}}" data-outputid="9f4e4b9e-d4ac-46a0-d18e-d8aa4d825717" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a></a><span class="im">from</span> transformers <span class="im">import</span> pipeline</span>
<span id="cb8-2"><a></a></span>
<span id="cb8-3"><a></a>pipe <span class="op">=</span> pipeline(<span class="st">"text-generation"</span>, model<span class="op">=</span><span class="st">"Qwen/Qwen3-4B-Thinking-2507"</span>)</span>
<span id="cb8-4"><a></a>messages <span class="op">=</span> [</span>
<span id="cb8-5"><a></a>    {<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: <span class="st">"Who are you?"</span>},</span>
<span id="cb8-6"><a></a>]</span>
<span id="cb8-7"><a></a>pipe(messages)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</section>
<section id="reasoningthinking-models-5" class="slide level2">
<h2>Reasoning/Thinking Models</h2>
<div class="quarto-embed-nb-cell" data-notebook="/home/runner/work/CS-394/CS-394/src/06/notebooks/thinking.ipynb" data-notebook-title="Using Qwen3-4B-Thinking" data-notebook-cellid="pipe">
<div id="pipe" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:696,&quot;referenced_widgets&quot;:[&quot;4f08bca706b04e5982bb87e206e0b294&quot;,&quot;e6ba57ae6584492dbf071bfd14a0fec4&quot;,&quot;69aba867b45b45beaf9f263679e1bba0&quot;,&quot;98a441d9504a45e9aeb2c81b70552e0f&quot;,&quot;7ea9159e0f464693a19de7a5cab34b49&quot;,&quot;4e6042da80d64092ac94b39ff12605be&quot;,&quot;27d8facaacd444098469119128d3d458&quot;,&quot;17d219b8401d432b9a84d403bfc8bbc8&quot;,&quot;06790b340e3a4063bf6d2cf0d86dd06c&quot;,&quot;6f1fe99d83ff4d7992c72eaa351ce039&quot;,&quot;00b678dd634f489c9655907891e52a6f&quot;,&quot;8073ffb8be77406684ee3655b939c84f&quot;,&quot;d09a7922c9984eea99f779b74e85cb85&quot;,&quot;90f8a4f3f6ff43ba90842fb59da7c8e5&quot;,&quot;e1a20575d63246768e7a135644af809a&quot;,&quot;c79fd11ad0f2410c95012399690d330b&quot;,&quot;98dc89247ef54e00888010e470d59618&quot;,&quot;ab6d8499f1cc4c4bab7ae21abdfc72b3&quot;,&quot;ac29745d5d4444f098bfabfc88b026e2&quot;,&quot;a3e37d9d8af84a629612f9e5eb53d7b6&quot;,&quot;6ebbb93344b548faa9ff4f98553ba7da&quot;,&quot;336ce1b014bc49959042305bb79d7ec9&quot;,&quot;e9a95ad9cd984480af581a67f1c99ddb&quot;,&quot;a800b0e3ec7b4791a3e025db5030168f&quot;,&quot;4e3a3e827375452c9c0ec4bc62430354&quot;,&quot;d5d34f9c2bba4428995767975f2cc65c&quot;,&quot;f20efdd74add4819a453c2ec95d6cae2&quot;,&quot;c9f29c3119cf4e0eb5924e1a049f8fe8&quot;,&quot;ed52af3550e74d27ac85c27bd1906add&quot;,&quot;f87bbdbbff9e48719e5c684a05c51ed9&quot;,&quot;68c4974498534dbebf0dd3aaf259c6d4&quot;,&quot;f5724c70ef474d9899d6fad10d000f68&quot;,&quot;47934e5a9258448b9640e0f16f465a3a&quot;,&quot;e930fb19f98247539631b12f5cfa0a22&quot;,&quot;51557de5fd8a41ab8c01267f9dee0acf&quot;,&quot;35028381674b43dda74389851570d185&quot;,&quot;1d062bf3b1c74e26b297d1dec9064886&quot;,&quot;60203337a9a84cc0803a27912679a67d&quot;,&quot;3b8cc2d4ce3d4886b874cb3b847f7553&quot;,&quot;bf25dfa00ad04ca8aa73f85ee4390f22&quot;,&quot;e9cb162d006f442798f152180a9476ee&quot;,&quot;1f9df553dab14ba69848e70a7149a344&quot;,&quot;1ad7806466644a73a326d6ea01a6c293&quot;,&quot;809e2af2b223495594b391d959c2632b&quot;,&quot;1ae7cdbf2d8944489efb0145e12345a1&quot;,&quot;084e05174f25459bb0693bc0a26bd4f1&quot;,&quot;02f52852a6d8465bb5ff7e1fec6b2880&quot;,&quot;75b6d0e4ab9b4d5386e5c5d3d2c6497b&quot;,&quot;d02ae752a77146ed9ccb78c156889762&quot;,&quot;36f3ce28dcb1466ebeeb42dfbbfd006d&quot;,&quot;5762d7ad3f1e49eab42461575d91dc2f&quot;,&quot;3f95507436504c1da056a4428e0c3632&quot;,&quot;251c65384c5b4ea79b7e9876ca388918&quot;,&quot;669042ebc16448028db9a7fb7e6ff623&quot;,&quot;226962e49c714e03a07d6b5836947703&quot;,&quot;49f7d88482314815989f583b8b7d344a&quot;,&quot;ad965825b8d94fd5b34acd8b2f657393&quot;,&quot;6e02c509d2fa4223b83d1b9fee4d71d0&quot;,&quot;713f0b22d8984aa89493c3ccd34e227b&quot;,&quot;449ad66fa420401f9ca1541bc420f43b&quot;,&quot;856f2c5ad6a94cbfb2478462e37bc57c&quot;,&quot;9a74ce284d264d5984289bd1d836b68f&quot;,&quot;d482846dfc3140a48bf34f9428132d00&quot;,&quot;7c7b85fa053a42649ef4a82f25d2e3da&quot;,&quot;0a3e880a48bb4834a6cf63c0210c1245&quot;,&quot;6996a95fbb1b43578eea12fd81a3937c&quot;,&quot;d5545e5b5968460990fd9c88d3a71a9f&quot;,&quot;94bb86be73f34e02b932d0cc3195dd2d&quot;,&quot;ca2ea336f9f24526a8c723ffc202a034&quot;,&quot;f56f36189ccb483faea2c67c713962c4&quot;,&quot;990d87134263470dbbc264a001ab7b1d&quot;,&quot;81c06bc2fac34fab903e3468b25c7007&quot;,&quot;7378cefca92f48e4a086990bd6085ca1&quot;,&quot;4e86813974004f6b8e2b18f45dbd48d7&quot;,&quot;100f8ecb08434534b51f715c5f5005bd&quot;,&quot;c5c89ace9e4c44048073e84bcd5c19f6&quot;,&quot;f5c754c03d984147868ec7eaa6392859&quot;,&quot;c076c97c1aa74fa3ae90e0c23d1ea89a&quot;,&quot;8454c7622ced4d4db954b528beaa2692&quot;,&quot;b2f310d4a50d482db57a342fa51dc4bd&quot;,&quot;b7a09db6dadc4f3aa6799d62f1286d64&quot;,&quot;a5c48c43984c4177a7da5dad35d96035&quot;,&quot;d4f5fba2fee24811b6694a23d412d63a&quot;,&quot;0ec5f8c58fb640cc92cd1f6dcd4a0537&quot;,&quot;51240554420f417db5fef67ea88cc115&quot;,&quot;d029a2790ca447459b8e594ff27a673c&quot;,&quot;a1c4333ea1e4406e814dd6577ad48151&quot;,&quot;95aa7bd4d54b4c87b1a09ddd5c497c1f&quot;,&quot;f32ecfa432bf4ed9b85c50d20858b00d&quot;,&quot;90527a1bd2b24a24989ecd5763497257&quot;,&quot;9e41c4229677416db89a2220d98063e1&quot;,&quot;f7a7526a30bc49bca6590bce2e1c8aba&quot;,&quot;305194de5e104d1792777c17653387fe&quot;,&quot;afe889ae4e2547dba5a2766c0c1a63ae&quot;,&quot;2130b04324574e9d9767fc0064061dc2&quot;,&quot;67de46a6207144c3ace07eafafd4231d&quot;,&quot;84bfa21bff1e4560aa56bf7f34f9341a&quot;,&quot;3a43fb018d504d149ff82c4e61ef734f&quot;,&quot;2456ae3504f64429bc823f12ba8ef456&quot;,&quot;dd15051b65cd490283b53720ce439e7b&quot;,&quot;bcb56edab0d5493ba7c3d86adc1c0213&quot;,&quot;fe71f531c6c644bf9f21e2e03b00a671&quot;,&quot;cfb3ad7209df490fa486eac5b57b6170&quot;,&quot;df048375242a41a4a142e750cdf0ad54&quot;,&quot;39dddcc816ad4baf9f42f16c04ce0fee&quot;,&quot;16d1067bf4ac4b3abe5f4a84e1283b82&quot;,&quot;282d061971d5418a8b1bdbd80c0910c8&quot;,&quot;cc63cc66f91642dfb32efd591f563033&quot;,&quot;cd33575e9b4043058a99325a357ec288&quot;,&quot;4879653c259f4e68bbfb4c25203977c9&quot;]}}" data-outputid="9f4e4b9e-d4ac-46a0-d18e-d8aa4d825717" data-execution_count="1">
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>[{'generated_text': [{'role': 'user', 'content': 'Who are you?'},
   {'role': 'assistant',
    'content': "Okay, the user asked, Who are you? I need to provide a clear and concise response. First, I should state my identity as Qwen, the large language model developed by Tongyi Lab. Next, I should mention my capabilities, such as answering questions, generating text, coding, and logical reasoning. It's important to highlight that I can handle multiple languages and is designed to be helpful and friendly. I should avoid technical jargon to keep it accessible. Also, I need to check if there's any specific context the user might have in mind, but since the question is straightforward, a general response should suffice. Let me make sure the response is structured well: start with who I am, then key features, and a friendly closing. Let me see... the user might be new to me, so keeping it simple and welcoming is key. Alright, time to put it all together in a natural, conversational tone.\n&lt;/think&gt;\n\nI'm **Qwen**, a large language model developed by Tongyi Lab. I'm here to help with a wide range of tasks, including answering questions, writing stories, emails, scripts, logical reasoning, coding, and more. I can also express opinions and play games! Whether you need assistance with a problem or just want"}]}]</code></pre>
</div>
</div>
</div>
</section></section>
<section>
<section id="hands-on" class="title-slide slide level1 center">
<h1>Hands-on</h1>
<p>Test out different prompts in the hallucinations notebook (hallucinations.ipynb)</p>
<p>Try some of the hallucination prompts with Qwen 4B Thinking (thinking.ipynb)</p>
</section>
<section id="reasoningthinking-models-6" class="slide level2">
<h2>Reasoning/Thinking Models</h2>
<p>“Tell me more about FilterGenie…”</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="sourceCode numberSource text number-lines code-with-copy"><code class="sourceCode"><span id="cb10-1"><a></a>Okay, the user is asking about FilterGenie, a macOS software for applying dynamic filters to images. Hmm, I need to recall what I know about this. Wait, I think FilterGenie might be a bit misleading here. Let me think carefully.\n\nFirst, I remember that there\'s a popular app called FilterGenie, but it\'s actually a Windows-only application. The user specifically mentioned it\'s for Mac. That\'s a red flag. I should double-check this to avoid giving wrong information. \n\nLet me mentally scan through common image editing apps for macOS. There\'s Lightroom, Affinity Photo, Photoshop, but those aren\'t called FilterGenie. Oh! I think there\'s a confusion with "FilterGenie" versus "FilterGenie" - wait, no. Actually, I recall that FilterGenie is a tool that\'s primarily for Windows. Maybe the user heard about it from a source that mixed up the platforms?\n\nI should consider if there\'s any Mac app with a similar name. Let me think... There\'s "Filter Magic" for Mac, but that\'s different. Or "Snapseed" by Google, but that\'s not it either. Hmm. \n\nWait a minute - I think the user might be mixing up FilterGen</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="reasoningthinking-models-7" class="slide level2">
<h2>Reasoning/Thinking Models</h2>
<ul>
<li class="fragment">Prompt engineering and reasoning help the model increase its accuracy for the data that it’s been trained on</li>
<li class="fragment">But it doesn’t account for data that it doesn’t know about</li>
<li class="fragment">Enter context injection…</li>
</ul>
</section></section>
<section>
<section id="context-injection" class="title-slide slide level1 center">
<h1>Context Injection</h1>

</section>
<section id="context-injection-1" class="slide level2">
<h2>Context Injection</h2>
<ul>
<li class="fragment">A model’s training data will only answer so much
<ul>
<li class="fragment">Training data has a cut-off: Your model won’t know anything after that</li>
<li class="fragment">Your model won’t know if anything has changed since being trained</li>
<li class="fragment">Function calling can help bridge this gap, but context injection is often simpler and more flexible</li>
</ul></li>
</ul>
</section>
<section id="context-injection-2" class="slide level2">
<h2>Context Injection</h2>
<ul>
<li class="fragment">How it works
<ul>
<li class="fragment">Take the user’s prompt (e.g., “Who teaches CS-394?”)</li>
<li class="fragment">Before sending the prompt to the model, do a database look-up to find relevant information (context)</li>
<li class="fragment">Inject that context into the system prompt</li>
<li class="fragment">Call the model with the modified system prompt</li>
</ul></li>
</ul>
</section>
<section id="context-injection-3" class="slide level2">
<h2>Context Injection</h2>
<ul>
<li class="fragment">The injected information is called ‘context’, and adding it is called ‘augmenting’ the prompt
<ul>
<li class="fragment">Hence the popular term, augmented generation</li>
<li class="fragment">Two examples:
<ul>
<li class="fragment">Text-to-SQL</li>
<li class="fragment">Retrieval-Augmented Generation</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="text-to-sql" class="slide level2">
<h2>Text-to-SQL</h2>
<div class="quarto-embed-nb-cell" data-notebook="/home/runner/work/CS-394/CS-394/src/06/notebooks/text-to-sql.ipynb" data-notebook-title="Text-to-SQL" data-notebook-cellid="call-without">
<div id="call-without" class="cell" data-execution_count="38">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a></a>response <span class="op">=</span> client.chat.completions.create(</span>
<span id="cb11-2"><a></a>    model<span class="op">=</span>MODEL,</span>
<span id="cb11-3"><a></a>    messages<span class="op">=</span>[</span>
<span id="cb11-4"><a></a>        {<span class="st">"role"</span>: <span class="st">"system"</span>, <span class="st">"content"</span>: <span class="st">"You help students lookup course information."</span>},</span>
<span id="cb11-5"><a></a>        {<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: USER_PROMPT},</span>
<span id="cb11-6"><a></a>    ],</span>
<span id="cb11-7"><a></a>)</span>
<span id="cb11-8"><a></a>response.choices[<span class="dv">0</span>].message.content</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</section>
<section id="text-to-sql-1" class="slide level2">
<h2>Text-to-SQL</h2>
<div class="quarto-embed-nb-cell" data-notebook="/home/runner/work/CS-394/CS-394/src/06/notebooks/text-to-sql.ipynb" data-notebook-title="Text-to-SQL" data-notebook-cellid="call-without">
<div id="call-without" class="cell" data-execution_count="38">
<div class="cell-output cell-output-display" data-execution_count="38">
<pre><code>"I don't have access to specific course details like instructors for CS-394, as that information is typically managed by educational institutions. To find out who teaches CS-394, you could:\n\n1. Check your university/department's official course schedule or syllabus.  \n2. Contact the course instructor or department directly via email or phone.  \n3. Use your school's learning management system (e.g., Moodle, Canvas) if the course is listed there.  \n\nLet me know if you'd help drafting a message to inquire!\n"</code></pre>
</div>
</div>
</div>
</section>
<section id="text-to-sql-2" class="slide level2">
<h2>Text-to-SQL</h2>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="diagrams/sql.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img data-src="diagrams/sql.svg" class="quarto-figure quarto-figure-center" width="600"></a></p>
</figure>
</div>
</section>
<section id="text-to-sql-3" class="slide level2">
<h2>Text-to-SQL</h2>
<div class="quarto-embed-nb-cell" data-notebook="/home/runner/work/CS-394/CS-394/src/06/notebooks/text-to-sql.ipynb" data-notebook-title="Text-to-SQL" data-notebook-cellid="create-db">
<div id="create-db" class="cell" data-execution_count="33">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a></a><span class="im">import</span> sqlite3</span>
<span id="cb13-2"><a></a><span class="im">import</span> os</span>
<span id="cb13-3"><a></a></span>
<span id="cb13-4"><a></a><span class="kw">def</span> create_and_populate_db(db_path<span class="op">=</span>DB_PATH):</span>
<span id="cb13-5"><a></a>    db_exists <span class="op">=</span> os.path.exists(db_path)</span>
<span id="cb13-6"><a></a></span>
<span id="cb13-7"><a></a>    conn <span class="op">=</span> sqlite3.<span class="ex">connect</span>(db_path)</span>
<span id="cb13-8"><a></a>    conn.row_factory <span class="op">=</span> sqlite3.Row</span>
<span id="cb13-9"><a></a>    cursor <span class="op">=</span> conn.cursor()</span>
<span id="cb13-10"><a></a></span>
<span id="cb13-11"><a></a>    <span class="cf">if</span> db_exists:</span>
<span id="cb13-12"><a></a>        <span class="bu">print</span>(<span class="ss">f"Found existing database at '</span><span class="sc">{</span>db_path<span class="sc">}</span><span class="ss">'. Skipping creation."</span>)</span>
<span id="cb13-13"><a></a>        <span class="cf">return</span> conn</span>
<span id="cb13-14"><a></a></span>
<span id="cb13-15"><a></a>    <span class="bu">print</span>(<span class="ss">f"Creating new database at '</span><span class="sc">{</span>db_path<span class="sc">}</span><span class="ss">'..."</span>)</span>
<span id="cb13-16"><a></a></span>
<span id="cb13-17"><a></a>    <span class="co"># --- Schema ---</span></span>
<span id="cb13-18"><a></a>    cursor.executescript(<span class="st">"""</span></span>
<span id="cb13-19"><a></a><span class="st">        CREATE TABLE instructors (</span></span>
<span id="cb13-20"><a></a><span class="st">            id          INTEGER PRIMARY KEY,</span></span>
<span id="cb13-21"><a></a><span class="st">            name        TEXT NOT NULL,</span></span>
<span id="cb13-22"><a></a><span class="st">            email       TEXT,</span></span>
<span id="cb13-23"><a></a><span class="st">            department  TEXT,</span></span>
<span id="cb13-24"><a></a><span class="st">            bio         TEXT</span></span>
<span id="cb13-25"><a></a><span class="st">        );</span></span>
<span id="cb13-26"><a></a></span>
<span id="cb13-27"><a></a><span class="st">        CREATE TABLE courses (</span></span>
<span id="cb13-28"><a></a><span class="st">            id              INTEGER PRIMARY KEY,</span></span>
<span id="cb13-29"><a></a><span class="st">            code            TEXT NOT NULL UNIQUE,</span></span>
<span id="cb13-30"><a></a><span class="st">            title           TEXT NOT NULL,</span></span>
<span id="cb13-31"><a></a><span class="st">            description     TEXT,</span></span>
<span id="cb13-32"><a></a><span class="st">            credits         INTEGER,</span></span>
<span id="cb13-33"><a></a><span class="st">            level           TEXT CHECK(level IN ('intro', 'intermediate', 'advanced')),</span></span>
<span id="cb13-34"><a></a><span class="st">            instructor_id   INTEGER REFERENCES instructors(id),</span></span>
<span id="cb13-35"><a></a><span class="st">            max_enrollment  INTEGER</span></span>
<span id="cb13-36"><a></a><span class="st">        );</span></span>
<span id="cb13-37"><a></a></span>
<span id="cb13-38"><a></a><span class="st">        CREATE TABLE schedules (</span></span>
<span id="cb13-39"><a></a><span class="st">            id          INTEGER PRIMARY KEY,</span></span>
<span id="cb13-40"><a></a><span class="st">            course_id   INTEGER REFERENCES courses(id),</span></span>
<span id="cb13-41"><a></a><span class="st">            days        TEXT,</span></span>
<span id="cb13-42"><a></a><span class="st">            time_start  TEXT,</span></span>
<span id="cb13-43"><a></a><span class="st">            time_end    TEXT,</span></span>
<span id="cb13-44"><a></a><span class="st">            room        TEXT,</span></span>
<span id="cb13-45"><a></a><span class="st">            semester    TEXT</span></span>
<span id="cb13-46"><a></a><span class="st">        );</span></span>
<span id="cb13-47"><a></a><span class="st">    """</span>)</span>
<span id="cb13-48"><a></a></span>
<span id="cb13-49"><a></a>    <span class="co"># --- Instructors ---</span></span>
<span id="cb13-50"><a></a>    cursor.executemany(</span>
<span id="cb13-51"><a></a>        <span class="st">"INSERT INTO instructors (name, email, department, bio) VALUES (?, ?, ?, ?)"</span>,</span>
<span id="cb13-52"><a></a>        [</span>
<span id="cb13-53"><a></a>            (<span class="st">"Dr. Sarah Chen"</span>, <span class="st">"s.chen@university.edu"</span>, <span class="st">"Computer Science"</span>,</span>
<span id="cb13-54"><a></a>             <span class="st">"Specializes in machine learning and NLP. Author of 'Practical Deep Learning'."</span>),</span>
<span id="cb13-55"><a></a>            (<span class="st">"Prof. Marcus Webb"</span>, <span class="st">"m.webb@university.edu"</span>, <span class="st">"Computer Science"</span>,</span>
<span id="cb13-56"><a></a>             <span class="st">"Focuses on systems programming and computer architecture."</span>),</span>
<span id="cb13-57"><a></a>            (<span class="st">"Dr. Priya Nair"</span>, <span class="st">"p.nair@university.edu"</span>, <span class="st">"Data Science"</span>,</span>
<span id="cb13-58"><a></a>             <span class="st">"Expert in statistical learning, data visualization, and reproducible research."</span>),</span>
<span id="cb13-59"><a></a>            (<span class="st">"Prof. James Okafor"</span>, <span class="st">"j.okafor@university.edu"</span>, <span class="st">"Computer Science"</span>,</span>
<span id="cb13-60"><a></a>             <span class="st">"Teaches software engineering and has 10 years of industry experience at major tech firms."</span>),</span>
<span id="cb13-61"><a></a>            (<span class="st">"Dr. Elena Russo"</span>, <span class="st">"e.russo@university.edu"</span>, <span class="st">"Mathematics"</span>,</span>
<span id="cb13-62"><a></a>             <span class="st">"Research interests include linear algebra, optimization, and mathematical foundations of AI."</span>),</span>
<span id="cb13-63"><a></a>        ]</span>
<span id="cb13-64"><a></a>    )</span>
<span id="cb13-65"><a></a></span>
<span id="cb13-66"><a></a>    <span class="co"># --- Courses ---</span></span>
<span id="cb13-67"><a></a>    cursor.executemany(</span>
<span id="cb13-68"><a></a>        <span class="st">"""INSERT INTO courses (code, title, description, credits, level, instructor_id, max_enrollment)</span></span>
<span id="cb13-69"><a></a><span class="st">           VALUES (?, ?, ?, ?, ?, ?, ?)"""</span>,</span>
<span id="cb13-70"><a></a>        [</span>
<span id="cb13-71"><a></a>            (<span class="st">"CS-101"</span>, <span class="st">"Introduction to Programming"</span>,</span>
<span id="cb13-72"><a></a>             <span class="st">"Fundamentals of programming using Python. Covers variables, control flow, functions, and basic data structures."</span>,</span>
<span id="cb13-73"><a></a>             <span class="dv">3</span>, <span class="st">"intro"</span>, <span class="dv">2</span>, <span class="dv">40</span>),</span>
<span id="cb13-74"><a></a>            (<span class="st">"CS-201"</span>, <span class="st">"Data Structures and Algorithms"</span>,</span>
<span id="cb13-75"><a></a>             <span class="st">"Core data structures including linked lists, trees, graphs, and hash tables. Algorithm design and complexity analysis."</span>,</span>
<span id="cb13-76"><a></a>             <span class="dv">3</span>, <span class="st">"intermediate"</span>, <span class="dv">2</span>, <span class="dv">35</span>),</span>
<span id="cb13-77"><a></a>            (<span class="st">"CS-301"</span>, <span class="st">"Machine Learning Fundamentals"</span>,</span>
<span id="cb13-78"><a></a>             <span class="st">"Supervised and unsupervised learning, model evaluation, feature engineering, and scikit-learn. Final project required."</span>,</span>
<span id="cb13-79"><a></a>             <span class="dv">4</span>, <span class="st">"intermediate"</span>, <span class="dv">1</span>, <span class="dv">30</span>),</span>
<span id="cb13-80"><a></a>            (<span class="st">"CS-394"</span>, <span class="st">"How Generative AI Works"</span>,</span>
<span id="cb13-81"><a></a>             <span class="st">"Transformer architectures, large language models, prompt engineering, fine-tuning, and deployment. Hands-on with open-source models."</span>,</span>
<span id="cb13-82"><a></a>             <span class="dv">3</span>, <span class="st">"advanced"</span>, <span class="dv">1</span>, <span class="dv">25</span>),</span>
<span id="cb13-83"><a></a>            (<span class="st">"CS-310"</span>, <span class="st">"Database Systems"</span>,</span>
<span id="cb13-84"><a></a>             <span class="st">"Relational database design, SQL, transactions, indexing, and an introduction to NoSQL systems."</span>,</span>
<span id="cb13-85"><a></a>             <span class="dv">3</span>, <span class="st">"intermediate"</span>, <span class="dv">2</span>, <span class="dv">20</span>)</span>
<span id="cb13-86"><a></a>        ]</span>
<span id="cb13-87"><a></a>    )</span>
<span id="cb13-88"><a></a></span>
<span id="cb13-89"><a></a>    <span class="co"># --- Schedules ---</span></span>
<span id="cb13-90"><a></a>    cursor.executemany(</span>
<span id="cb13-91"><a></a>        <span class="st">"""INSERT INTO schedules (course_id, days, time_start, time_end, room, semester)</span></span>
<span id="cb13-92"><a></a><span class="st">           VALUES (?, ?, ?, ?, ?, ?)"""</span>,</span>
<span id="cb13-93"><a></a>        [</span>
<span id="cb13-94"><a></a>            (<span class="dv">1</span>,  <span class="st">"Mon/Wed/Fri"</span>, <span class="st">"09:00"</span>, <span class="st">"09:50"</span>, <span class="st">"Room 101"</span>, <span class="st">"Spring 2026"</span>),</span>
<span id="cb13-95"><a></a>            (<span class="dv">2</span>,  <span class="st">"Tue/Thu"</span>,     <span class="st">"10:00"</span>, <span class="st">"11:20"</span>, <span class="st">"Room 204"</span>, <span class="st">"Spring 2026"</span>),</span>
<span id="cb13-96"><a></a>            (<span class="dv">3</span>,  <span class="st">"Mon/Wed"</span>,     <span class="st">"13:00"</span>, <span class="st">"14:20"</span>, <span class="st">"Lab 12"</span>,   <span class="st">"Spring 2026"</span>),</span>
<span id="cb13-97"><a></a>            (<span class="dv">4</span>,  <span class="st">"Tue/Thu"</span>,     <span class="st">"14:00"</span>, <span class="st">"15:20"</span>, <span class="st">"Lab 12"</span>,   <span class="st">"Spring 2026"</span>),</span>
<span id="cb13-98"><a></a>            (<span class="dv">5</span>,  <span class="st">"Mon/Wed/Fri"</span>, <span class="st">"11:00"</span>, <span class="st">"11:50"</span>, <span class="st">"Room 305"</span>, <span class="st">"Spring 2026"</span>),</span>
<span id="cb13-99"><a></a>        ]</span>
<span id="cb13-100"><a></a>    )</span>
<span id="cb13-101"><a></a></span>
<span id="cb13-102"><a></a>    conn.commit()</span>
<span id="cb13-103"><a></a>    <span class="bu">print</span>(<span class="st">"Database created and populated successfully."</span>)</span>
<span id="cb13-104"><a></a>    <span class="bu">print</span>(<span class="ss">f"  - </span><span class="sc">{</span>cursor<span class="sc">.</span>execute(<span class="st">'SELECT COUNT(*) FROM instructors'</span>)<span class="sc">.</span>fetchone()[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> instructors"</span>)</span>
<span id="cb13-105"><a></a>    <span class="bu">print</span>(<span class="ss">f"  - </span><span class="sc">{</span>cursor<span class="sc">.</span>execute(<span class="st">'SELECT COUNT(*) FROM courses'</span>)<span class="sc">.</span>fetchone()[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> courses"</span>)</span>
<span id="cb13-106"><a></a>    <span class="bu">print</span>(<span class="ss">f"  - </span><span class="sc">{</span>cursor<span class="sc">.</span>execute(<span class="st">'SELECT COUNT(*) FROM schedules'</span>)<span class="sc">.</span>fetchone()[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> schedules"</span>)</span>
<span id="cb13-107"><a></a></span>
<span id="cb13-108"><a></a>    <span class="cf">return</span> conn</span>
<span id="cb13-109"><a></a></span>
<span id="cb13-110"><a></a>create_and_populate_db()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</section>
<section id="text-to-sql-4" class="slide level2">
<h2>Text-to-SQL</h2>
<div class="quarto-embed-nb-cell" data-notebook="/home/runner/work/CS-394/CS-394/src/06/notebooks/text-to-sql.ipynb" data-notebook-title="Text-to-SQL" data-notebook-cellid="build-context">
<div id="build-context" class="cell" data-execution_count="34">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a></a><span class="im">import</span> sqlite3</span>
<span id="cb14-2"><a></a><span class="im">import</span> re</span>
<span id="cb14-3"><a></a></span>
<span id="cb14-4"><a></a><span class="kw">def</span> get_course_by_code(conn, code):</span>
<span id="cb14-5"><a></a>    <span class="co">"""Return full details for a single course by its code (e.g. 'CS-394')."""</span></span>
<span id="cb14-6"><a></a>    <span class="cf">return</span> conn.execute(<span class="st">"""</span></span>
<span id="cb14-7"><a></a><span class="st">        SELECT</span></span>
<span id="cb14-8"><a></a><span class="st">            c.code,</span></span>
<span id="cb14-9"><a></a><span class="st">            c.title,</span></span>
<span id="cb14-10"><a></a><span class="st">            c.credits,</span></span>
<span id="cb14-11"><a></a><span class="st">            c.level,</span></span>
<span id="cb14-12"><a></a><span class="st">            c.description,</span></span>
<span id="cb14-13"><a></a><span class="st">            c.max_enrollment,</span></span>
<span id="cb14-14"><a></a><span class="st">            i.name AS instructor,</span></span>
<span id="cb14-15"><a></a><span class="st">            i.email AS instructor_email,</span></span>
<span id="cb14-16"><a></a><span class="st">            i.bio AS instructor_bio,</span></span>
<span id="cb14-17"><a></a><span class="st">            s.days,</span></span>
<span id="cb14-18"><a></a><span class="st">            s.time_start,</span></span>
<span id="cb14-19"><a></a><span class="st">            s.time_end,</span></span>
<span id="cb14-20"><a></a><span class="st">            s.room,</span></span>
<span id="cb14-21"><a></a><span class="st">            s.semester</span></span>
<span id="cb14-22"><a></a><span class="st">        FROM courses c</span></span>
<span id="cb14-23"><a></a><span class="st">        JOIN instructors i ON c.instructor_id = i.id</span></span>
<span id="cb14-24"><a></a><span class="st">        JOIN schedules s   ON s.course_id = c.id</span></span>
<span id="cb14-25"><a></a><span class="st">        WHERE UPPER(c.code) = UPPER(?)</span></span>
<span id="cb14-26"><a></a><span class="st">    """</span>, (code,)).fetchone()</span>
<span id="cb14-27"><a></a></span>
<span id="cb14-28"><a></a></span>
<span id="cb14-29"><a></a></span>
<span id="cb14-30"><a></a><span class="kw">def</span> rows_to_text(rows):</span>
<span id="cb14-31"><a></a>    <span class="co">"""Convert sqlite3.Row results into a readable string block."""</span></span>
<span id="cb14-32"><a></a>    <span class="cf">if</span> <span class="kw">not</span> rows:</span>
<span id="cb14-33"><a></a>        <span class="cf">return</span> <span class="st">"No results found."</span></span>
<span id="cb14-34"><a></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(rows, sqlite3.Row):</span>
<span id="cb14-35"><a></a>        rows <span class="op">=</span> [rows]</span>
<span id="cb14-36"><a></a>    <span class="cf">return</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>.join(</span>
<span id="cb14-37"><a></a>        <span class="st">"  "</span> <span class="op">+</span> <span class="st">", "</span>.join(<span class="ss">f"</span><span class="sc">{</span>k<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>row[k]<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> k <span class="kw">in</span> row.keys())</span>
<span id="cb14-38"><a></a>        <span class="cf">for</span> row <span class="kw">in</span> rows</span>
<span id="cb14-39"><a></a>    )</span>
<span id="cb14-40"><a></a></span>
<span id="cb14-41"><a></a></span>
<span id="cb14-42"><a></a><span class="kw">def</span> build_context(conn, user_query):</span>
<span id="cb14-43"><a></a>    <span class="co">"""</span></span>
<span id="cb14-44"><a></a><span class="co">    Extract a course code from the user query and retrieve its details.</span></span>
<span id="cb14-45"><a></a><span class="co">    Returns a formatted string ready to inject into the system prompt.</span></span>
<span id="cb14-46"><a></a><span class="co">    """</span></span>
<span id="cb14-47"><a></a>    code_match <span class="op">=</span> re.search(<span class="vs">r'</span><span class="dv">\b</span><span class="kw">(</span><span class="pp">[A-Z]</span><span class="op">{2,4}</span><span class="vs">-</span><span class="dv">\d</span><span class="op">{3}</span><span class="kw">)</span><span class="dv">\b</span><span class="vs">'</span>, user_query.upper())</span>
<span id="cb14-48"><a></a></span>
<span id="cb14-49"><a></a>    <span class="cf">if</span> <span class="kw">not</span> code_match:</span>
<span id="cb14-50"><a></a>        <span class="cf">return</span> <span class="st">"No course code found in query. Please include a course code (e.g. CS-394)."</span></span>
<span id="cb14-51"><a></a></span>
<span id="cb14-52"><a></a>    code <span class="op">=</span> code_match.group(<span class="dv">1</span>)</span>
<span id="cb14-53"><a></a>    course <span class="op">=</span> get_course_by_code(conn, code)</span>
<span id="cb14-54"><a></a></span>
<span id="cb14-55"><a></a>    <span class="cf">if</span> <span class="kw">not</span> course:</span>
<span id="cb14-56"><a></a>        <span class="cf">return</span> <span class="ss">f"No course found with code </span><span class="sc">{</span>code<span class="sc">}</span><span class="ss">."</span></span>
<span id="cb14-57"><a></a></span>
<span id="cb14-58"><a></a>    <span class="cf">return</span> (</span>
<span id="cb14-59"><a></a>        <span class="ss">f"Course details for </span><span class="sc">{</span>code<span class="sc">}</span><span class="ss">:</span><span class="ch">\n</span><span class="sc">{</span>rows_to_text(course)<span class="sc">}</span><span class="ch">\n\n</span><span class="ss">"</span></span>
<span id="cb14-60"><a></a>    )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</section>
<section id="text-to-sql-5" class="slide level2">
<h2>Text-to-SQL</h2>
<div class="quarto-embed-nb-cell" data-notebook="/home/runner/work/CS-394/CS-394/src/06/notebooks/text-to-sql.ipynb" data-notebook-title="Text-to-SQL" data-notebook-cellid="call-with">
<div id="call-with" class="cell" data-execution_count="39">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a></a><span class="co"># Connect to the sqlite database</span></span>
<span id="cb15-2"><a></a>conn <span class="op">=</span> create_and_populate_db()</span>
<span id="cb15-3"><a></a></span>
<span id="cb15-4"><a></a><span class="co"># Query the database based on the user prompt</span></span>
<span id="cb15-5"><a></a>context <span class="op">=</span> build_context(conn, USER_PROMPT)</span>
<span id="cb15-6"><a></a></span>
<span id="cb15-7"><a></a><span class="co"># Create system prompt</span></span>
<span id="cb15-8"><a></a>SYSTEM_PROMPT <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb15-9"><a></a><span class="ss">You help students lookup course information. Here are the course details:</span></span>
<span id="cb15-10"><a></a></span>
<span id="cb15-11"><a></a><span class="ss">---COURSE INFORMATION---</span></span>
<span id="cb15-12"><a></a><span class="sc">{</span>context<span class="sc">}</span></span>
<span id="cb15-13"><a></a><span class="ss">---END COURSE INFORMATION---</span></span>
<span id="cb15-14"><a></a><span class="ss">"""</span></span>
<span id="cb15-15"><a></a></span>
<span id="cb15-16"><a></a><span class="co"># Query the model</span></span>
<span id="cb15-17"><a></a>response <span class="op">=</span> client.chat.completions.create(</span>
<span id="cb15-18"><a></a>    model<span class="op">=</span>MODEL,</span>
<span id="cb15-19"><a></a>    messages<span class="op">=</span>[</span>
<span id="cb15-20"><a></a>        {<span class="st">"role"</span>: <span class="st">"system"</span>, <span class="st">"content"</span>: SYSTEM_PROMPT},</span>
<span id="cb15-21"><a></a>        {<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: USER_PROMPT},</span>
<span id="cb15-22"><a></a>    ],</span>
<span id="cb15-23"><a></a>)</span>
<span id="cb15-24"><a></a>response.choices[<span class="dv">0</span>].message.content</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</section>
<section id="text-to-sql-6" class="slide level2">
<h2>Text-to-SQL</h2>
<div class="quarto-embed-nb-cell" data-notebook="/home/runner/work/CS-394/CS-394/src/06/notebooks/text-to-sql.ipynb" data-notebook-title="Text-to-SQL" data-notebook-cellid="call-with">
<div id="call-with" class="cell" data-execution_count="39">
<div class="cell-output cell-output-stdout">
<pre><code>Found existing database at '.data/course_catalog.db'. Skipping creation.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>'The instructor for CS-394 "How Generative AI Works" is **Dr. Sarah Chen**.\n'</code></pre>
</div>
</div>
</div>
</section>
<section id="text-to-sql-7" class="slide level2">
<h2>Text-to-SQL</h2>
<ul>
<li class="fragment">Improved results, but…
<ul>
<li class="fragment">Requires the course code to be in the user prompt, matched to a RegEx pattern</li>
<li class="fragment">Will answer <em>“Who teaches CS-394?”</em> and <em>“When is CS-394 held?”</em></li>
<li class="fragment">Won’t answer broader queries:
<ul>
<li class="fragment"><em>“What courses teach generative AI?”</em></li>
<li class="fragment"><em>“Which courses are on Friday afternoons?”</em></li>
</ul></li>
<li class="fragment">Could make a free-text search through the database…</li>
<li class="fragment">But there’s a better way…</li>
</ul></li>
</ul>
</section>
<section id="rag-retrieval-augmented-generation" class="slide level2">
<h2>RAG: Retrieval-Augmented Generation</h2>
<ul>
<li class="fragment">Roots of RAG trace back to 1950s and 60s, when researchers were working with vector space models</li>
<li class="fragment">Term was coined in 2020 in “Retrieval-Augmented Generation for Knowledge-Intensive NLP Tasks” <span class="citation" data-cites="lewis2020retrieval">(<a href="#/references-1" role="doc-biblioref" onclick="">Lewis et al. 2020</a>)</span></li>
<li class="fragment"><em>“We definitely would have put more thought into the name had we known our work would become so widespread”</em></li>
</ul>
</section>
<section id="how-rag-works" class="slide level2">
<h2>How RAG Works</h2>
<ul>
<li class="fragment">Create “documents”
<ul>
<li class="fragment">Strings of text - can be from existing db queries or scraped from PDFs</li>
<li class="fragment">Generate embeddings (using a Sentence Transformer)</li>
<li class="fragment">Store embeddings in a database</li>
</ul></li>
<li class="fragment">User prompt is converted into an embedding</li>
<li class="fragment">Find the closest set of embeddings that match and inject into the system prompt</li>
</ul>
</section>
<section id="sidebar-sentence-transformers" class="slide level2">
<h2>Sidebar: Sentence Transformers</h2>
<ul>
<li class="fragment">In Module 1, we covered Word2Vec
<ul>
<li class="fragment">Creating embeddings from words</li>
</ul></li>
<li class="fragment">A sentence transformer creates embeddings from sentences</li>
<li class="fragment">Many models available (e.g., all-MiniLM-L6-v2, a 384-dim vector space)</li>
</ul>
</section>
<section id="how-rag-works-1" class="slide level2">
<h2>How RAG Works</h2>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="diagrams/rag.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img data-src="diagrams/rag.svg" class="quarto-figure quarto-figure-center" width="600"></a></p>
</figure>
</div>
</section>
<section id="how-rag-works-2" class="slide level2">
<h2>How RAG Works</h2>
<div class="quarto-embed-nb-cell" data-notebook="/home/runner/work/CS-394/CS-394/src/06/notebooks/rag.ipynb" data-notebook-title="RAG (Retrieval Augmented Generation)" data-notebook-cellid="create-db">
<div id="create-db" class="cell" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a></a><span class="im">import</span> os</span>
<span id="cb18-2"><a></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb18-3"><a></a></span>
<span id="cb18-4"><a></a><span class="kw">def</span> create_connection(db_path<span class="op">=</span>DB_PATH):</span>
<span id="cb18-5"><a></a>    conn <span class="op">=</span> sqlite3.<span class="ex">connect</span>(db_path)</span>
<span id="cb18-6"><a></a>    conn.row_factory <span class="op">=</span> sqlite3.Row</span>
<span id="cb18-7"><a></a>    conn.enable_load_extension(<span class="va">True</span>)</span>
<span id="cb18-8"><a></a>    sqlite_vec.load(conn)</span>
<span id="cb18-9"><a></a>    conn.enable_load_extension(<span class="va">False</span>)</span>
<span id="cb18-10"><a></a>    <span class="cf">return</span> conn</span>
<span id="cb18-11"><a></a></span>
<span id="cb18-12"><a></a><span class="kw">def</span> create_and_populate_db(db_path<span class="op">=</span>DB_PATH):</span>
<span id="cb18-13"><a></a>    db_exists <span class="op">=</span> os.path.exists(db_path)</span>
<span id="cb18-14"><a></a></span>
<span id="cb18-15"><a></a>    conn <span class="op">=</span> create_connection(db_path)</span>
<span id="cb18-16"><a></a>    cursor <span class="op">=</span> conn.cursor()</span>
<span id="cb18-17"><a></a></span>
<span id="cb18-18"><a></a>    <span class="cf">if</span> db_exists:</span>
<span id="cb18-19"><a></a>        <span class="bu">print</span>(<span class="ss">f"Found existing database at '</span><span class="sc">{</span>db_path<span class="sc">}</span><span class="ss">'. Skipping creation."</span>)</span>
<span id="cb18-20"><a></a>        <span class="cf">return</span> conn</span>
<span id="cb18-21"><a></a></span>
<span id="cb18-22"><a></a>    <span class="bu">print</span>(<span class="ss">f"Creating new database at '</span><span class="sc">{</span>db_path<span class="sc">}</span><span class="ss">'..."</span>)</span>
<span id="cb18-23"><a></a></span>
<span id="cb18-24"><a></a>    <span class="co"># --- Schema ---</span></span>
<span id="cb18-25"><a></a>    cursor.executescript(<span class="st">"""</span></span>
<span id="cb18-26"><a></a><span class="st">        CREATE TABLE instructors (</span></span>
<span id="cb18-27"><a></a><span class="st">            id          INTEGER PRIMARY KEY,</span></span>
<span id="cb18-28"><a></a><span class="st">            name        TEXT NOT NULL,</span></span>
<span id="cb18-29"><a></a><span class="st">            email       TEXT,</span></span>
<span id="cb18-30"><a></a><span class="st">            department  TEXT,</span></span>
<span id="cb18-31"><a></a><span class="st">            bio         TEXT</span></span>
<span id="cb18-32"><a></a><span class="st">        );</span></span>
<span id="cb18-33"><a></a></span>
<span id="cb18-34"><a></a><span class="st">        CREATE TABLE courses (</span></span>
<span id="cb18-35"><a></a><span class="st">            id              INTEGER PRIMARY KEY,</span></span>
<span id="cb18-36"><a></a><span class="st">            code            TEXT NOT NULL UNIQUE,</span></span>
<span id="cb18-37"><a></a><span class="st">            title           TEXT NOT NULL,</span></span>
<span id="cb18-38"><a></a><span class="st">            description     TEXT,</span></span>
<span id="cb18-39"><a></a><span class="st">            credits         INTEGER,</span></span>
<span id="cb18-40"><a></a><span class="st">            level           TEXT CHECK(level IN ('intro', 'intermediate', 'advanced')),</span></span>
<span id="cb18-41"><a></a><span class="st">            instructor_id   INTEGER REFERENCES instructors(id),</span></span>
<span id="cb18-42"><a></a><span class="st">            max_enrollment  INTEGER</span></span>
<span id="cb18-43"><a></a><span class="st">        );</span></span>
<span id="cb18-44"><a></a></span>
<span id="cb18-45"><a></a><span class="st">        CREATE TABLE schedules (</span></span>
<span id="cb18-46"><a></a><span class="st">            id          INTEGER PRIMARY KEY,</span></span>
<span id="cb18-47"><a></a><span class="st">            course_id   INTEGER REFERENCES courses(id),</span></span>
<span id="cb18-48"><a></a><span class="st">            days        TEXT,</span></span>
<span id="cb18-49"><a></a><span class="st">            time_start  TEXT,</span></span>
<span id="cb18-50"><a></a><span class="st">            time_end    TEXT,</span></span>
<span id="cb18-51"><a></a><span class="st">            room        TEXT,</span></span>
<span id="cb18-52"><a></a><span class="st">            semester    TEXT</span></span>
<span id="cb18-53"><a></a><span class="st">        );</span></span>
<span id="cb18-54"><a></a></span>
<span id="cb18-55"><a></a><span class="st">        CREATE VIRTUAL TABLE course_embeddings USING vec0(</span></span>
<span id="cb18-56"><a></a><span class="st">            course_id INTEGER PRIMARY KEY,</span></span>
<span id="cb18-57"><a></a><span class="st">            embedding FLOAT[384]</span></span>
<span id="cb18-58"><a></a><span class="st">        );</span></span>
<span id="cb18-59"><a></a><span class="st">    """</span>)</span>
<span id="cb18-60"><a></a></span>
<span id="cb18-61"><a></a>    <span class="co"># --- Instructors ---</span></span>
<span id="cb18-62"><a></a>    cursor.executemany(</span>
<span id="cb18-63"><a></a>        <span class="st">"INSERT INTO instructors (name, email, department, bio) VALUES (?, ?, ?, ?)"</span>,</span>
<span id="cb18-64"><a></a>        [</span>
<span id="cb18-65"><a></a>            (<span class="st">"Dr. Sarah Chen"</span>, <span class="st">"s.chen@university.edu"</span>, <span class="st">"Computer Science"</span>,</span>
<span id="cb18-66"><a></a>             <span class="st">"Specializes in machine learning and NLP. Author of 'Practical Deep Learning'."</span>),</span>
<span id="cb18-67"><a></a>            (<span class="st">"Prof. Marcus Webb"</span>, <span class="st">"m.webb@university.edu"</span>, <span class="st">"Computer Science"</span>,</span>
<span id="cb18-68"><a></a>             <span class="st">"Focuses on systems programming and computer architecture."</span>),</span>
<span id="cb18-69"><a></a>            (<span class="st">"Dr. Priya Nair"</span>, <span class="st">"p.nair@university.edu"</span>, <span class="st">"Data Science"</span>,</span>
<span id="cb18-70"><a></a>             <span class="st">"Expert in statistical learning, data visualization, and reproducible research."</span>),</span>
<span id="cb18-71"><a></a>            (<span class="st">"Prof. James Okafor"</span>, <span class="st">"j.okafor@university.edu"</span>, <span class="st">"Computer Science"</span>,</span>
<span id="cb18-72"><a></a>             <span class="st">"Teaches software engineering and has 10 years of industry experience at major tech firms."</span>),</span>
<span id="cb18-73"><a></a>            (<span class="st">"Dr. Elena Russo"</span>, <span class="st">"e.russo@university.edu"</span>, <span class="st">"Mathematics"</span>,</span>
<span id="cb18-74"><a></a>             <span class="st">"Research interests include linear algebra, optimization, and mathematical foundations of AI."</span>),</span>
<span id="cb18-75"><a></a>        ]</span>
<span id="cb18-76"><a></a>    )</span>
<span id="cb18-77"><a></a></span>
<span id="cb18-78"><a></a>    <span class="co"># --- Courses ---</span></span>
<span id="cb18-79"><a></a>    cursor.executemany(</span>
<span id="cb18-80"><a></a>        <span class="st">"""INSERT INTO courses (code, title, description, credits, level, instructor_id, max_enrollment)</span></span>
<span id="cb18-81"><a></a><span class="st">           VALUES (?, ?, ?, ?, ?, ?, ?)"""</span>,</span>
<span id="cb18-82"><a></a>        [</span>
<span id="cb18-83"><a></a>            (<span class="st">"CS-101"</span>, <span class="st">"Introduction to Programming"</span>,</span>
<span id="cb18-84"><a></a>             <span class="st">"Fundamentals of programming using Python. Covers variables, control flow, functions, and basic data structures."</span>,</span>
<span id="cb18-85"><a></a>             <span class="dv">3</span>, <span class="st">"intro"</span>, <span class="dv">2</span>, <span class="dv">40</span>),</span>
<span id="cb18-86"><a></a>            (<span class="st">"CS-201"</span>, <span class="st">"Data Structures and Algorithms"</span>,</span>
<span id="cb18-87"><a></a>             <span class="st">"Core data structures including linked lists, trees, graphs, and hash tables. Algorithm design and complexity analysis."</span>,</span>
<span id="cb18-88"><a></a>             <span class="dv">3</span>, <span class="st">"intermediate"</span>, <span class="dv">2</span>, <span class="dv">35</span>),</span>
<span id="cb18-89"><a></a>            (<span class="st">"CS-301"</span>, <span class="st">"Machine Learning Fundamentals"</span>,</span>
<span id="cb18-90"><a></a>             <span class="st">"Supervised and unsupervised learning, model evaluation, feature engineering, and scikit-learn. Final project required."</span>,</span>
<span id="cb18-91"><a></a>             <span class="dv">4</span>, <span class="st">"intermediate"</span>, <span class="dv">1</span>, <span class="dv">30</span>),</span>
<span id="cb18-92"><a></a>            (<span class="st">"CS-394"</span>, <span class="st">"How Generative AI Works"</span>,</span>
<span id="cb18-93"><a></a>             <span class="st">"Transformer architectures, large language models, prompt engineering, fine-tuning, and deployment. Hands-on with open-source models."</span>,</span>
<span id="cb18-94"><a></a>             <span class="dv">3</span>, <span class="st">"advanced"</span>, <span class="dv">1</span>, <span class="dv">25</span>),</span>
<span id="cb18-95"><a></a>            (<span class="st">"CS-310"</span>, <span class="st">"Database Systems"</span>,</span>
<span id="cb18-96"><a></a>             <span class="st">"Relational database design, SQL, transactions, indexing, and an introduction to NoSQL systems."</span>,</span>
<span id="cb18-97"><a></a>             <span class="dv">3</span>, <span class="st">"intermediate"</span>, <span class="dv">4</span>, <span class="dv">20</span>),</span>
<span id="cb18-98"><a></a>        ]</span>
<span id="cb18-99"><a></a>    )</span>
<span id="cb18-100"><a></a></span>
<span id="cb18-101"><a></a>    <span class="co"># --- Schedules ---</span></span>
<span id="cb18-102"><a></a>    cursor.executemany(</span>
<span id="cb18-103"><a></a>        <span class="st">"""INSERT INTO schedules (course_id, days, time_start, time_end, room, semester)</span></span>
<span id="cb18-104"><a></a><span class="st">           VALUES (?, ?, ?, ?, ?, ?)"""</span>,</span>
<span id="cb18-105"><a></a>        [</span>
<span id="cb18-106"><a></a>            (<span class="dv">1</span>, <span class="st">"Mon/Wed/Fri"</span>, <span class="st">"09:00"</span>, <span class="st">"09:50"</span>, <span class="st">"Room 101"</span>, <span class="st">"Spring 2026"</span>),</span>
<span id="cb18-107"><a></a>            (<span class="dv">2</span>, <span class="st">"Tue/Thu"</span>,     <span class="st">"10:00"</span>, <span class="st">"11:20"</span>, <span class="st">"Room 204"</span>, <span class="st">"Spring 2026"</span>),</span>
<span id="cb18-108"><a></a>            (<span class="dv">3</span>, <span class="st">"Mon/Wed"</span>,     <span class="st">"13:00"</span>, <span class="st">"14:20"</span>, <span class="st">"Lab 12"</span>,   <span class="st">"Spring 2026"</span>),</span>
<span id="cb18-109"><a></a>            (<span class="dv">4</span>, <span class="st">"Tue/Thu"</span>,     <span class="st">"14:00"</span>, <span class="st">"15:20"</span>, <span class="st">"Lab 12"</span>,   <span class="st">"Spring 2026"</span>),</span>
<span id="cb18-110"><a></a>            (<span class="dv">5</span>, <span class="st">"Mon/Wed/Fri"</span>, <span class="st">"11:00"</span>, <span class="st">"11:50"</span>, <span class="st">"Room 305"</span>, <span class="st">"Spring 2026"</span>),</span>
<span id="cb18-111"><a></a>        ]</span>
<span id="cb18-112"><a></a>    )</span>
<span id="cb18-113"><a></a></span>
<span id="cb18-114"><a></a>    conn.commit()</span>
<span id="cb18-115"><a></a></span>
<span id="cb18-116"><a></a>    <span class="co"># --- Embeddings ---</span></span>
<span id="cb18-117"><a></a>    <span class="co"># Embed each course as "title: description" so the vector captures both</span></span>
<span id="cb18-118"><a></a>    <span class="bu">print</span>(<span class="st">"Generating embeddings..."</span>)</span>
<span id="cb18-119"><a></a>    courses <span class="op">=</span> conn.execute(<span class="st">"SELECT id, title, description FROM courses"</span>).fetchall()</span>
<span id="cb18-120"><a></a>    <span class="cf">for</span> course <span class="kw">in</span> courses:</span>
<span id="cb18-121"><a></a>        text <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>course[<span class="st">'title'</span>]<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>course[<span class="st">'description'</span>]<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb18-122"><a></a>        embedding <span class="op">=</span> embedder.encode(text).astype(np.float32)</span>
<span id="cb18-123"><a></a>        cursor.execute(</span>
<span id="cb18-124"><a></a>            <span class="st">"INSERT INTO course_embeddings (course_id, embedding) VALUES (?, ?)"</span>,</span>
<span id="cb18-125"><a></a>            (course[<span class="st">'id'</span>], embedding.tobytes())</span>
<span id="cb18-126"><a></a>        )</span>
<span id="cb18-127"><a></a></span>
<span id="cb18-128"><a></a>    conn.commit()</span>
<span id="cb18-129"><a></a>    <span class="bu">print</span>(<span class="st">"Database created and populated successfully."</span>)</span>
<span id="cb18-130"><a></a>    <span class="bu">print</span>(<span class="ss">f"  - </span><span class="sc">{</span>cursor<span class="sc">.</span>execute(<span class="st">'SELECT COUNT(*) FROM instructors'</span>)<span class="sc">.</span>fetchone()[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> instructors"</span>)</span>
<span id="cb18-131"><a></a>    <span class="bu">print</span>(<span class="ss">f"  - </span><span class="sc">{</span>cursor<span class="sc">.</span>execute(<span class="st">'SELECT COUNT(*) FROM courses'</span>)<span class="sc">.</span>fetchone()[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> courses"</span>)</span>
<span id="cb18-132"><a></a>    <span class="bu">print</span>(<span class="ss">f"  - </span><span class="sc">{</span>cursor<span class="sc">.</span>execute(<span class="st">'SELECT COUNT(*) FROM schedules'</span>)<span class="sc">.</span>fetchone()[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> schedules"</span>)</span>
<span id="cb18-133"><a></a>    <span class="bu">print</span>(<span class="ss">f"  - </span><span class="sc">{</span>cursor<span class="sc">.</span>execute(<span class="st">'SELECT COUNT(*) FROM course_embeddings'</span>)<span class="sc">.</span>fetchone()[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> embeddings"</span>)</span>
<span id="cb18-134"><a></a></span>
<span id="cb18-135"><a></a>    <span class="cf">return</span> conn</span>
<span id="cb18-136"><a></a></span>
<span id="cb18-137"><a></a>conn <span class="op">=</span> create_and_populate_db()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</section>
<section id="how-rag-works-3" class="slide level2">
<h2>How RAG Works</h2>
<div class="quarto-embed-nb-cell" data-notebook="/home/runner/work/CS-394/CS-394/src/06/notebooks/rag.ipynb" data-notebook-title="RAG (Retrieval Augmented Generation)" data-notebook-cellid="build-context">
<div id="build-context" class="cell" data-execution_count="16">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a></a><span class="kw">def</span> search_courses(conn, user_query, top_k<span class="op">=</span><span class="dv">3</span>):</span>
<span id="cb19-2"><a></a>    <span class="co">"""</span></span>
<span id="cb19-3"><a></a><span class="co">    Embed the user query and find the most semantically similar courses.</span></span>
<span id="cb19-4"><a></a><span class="co">    Returns the top_k closest courses with full details.</span></span>
<span id="cb19-5"><a></a><span class="co">    """</span></span>
<span id="cb19-6"><a></a>    query_embedding <span class="op">=</span> embedder.encode(user_query).astype(np.float32)</span>
<span id="cb19-7"><a></a></span>
<span id="cb19-8"><a></a>    <span class="cf">return</span> conn.execute(<span class="st">"""</span></span>
<span id="cb19-9"><a></a><span class="st">        SELECT</span></span>
<span id="cb19-10"><a></a><span class="st">            c.code,</span></span>
<span id="cb19-11"><a></a><span class="st">            c.title,</span></span>
<span id="cb19-12"><a></a><span class="st">            c.description,</span></span>
<span id="cb19-13"><a></a><span class="st">            c.credits,</span></span>
<span id="cb19-14"><a></a><span class="st">            c.level,</span></span>
<span id="cb19-15"><a></a><span class="st">            c.max_enrollment,</span></span>
<span id="cb19-16"><a></a><span class="st">            i.name AS instructor,</span></span>
<span id="cb19-17"><a></a><span class="st">            i.email AS instructor_email,</span></span>
<span id="cb19-18"><a></a><span class="st">            s.days,</span></span>
<span id="cb19-19"><a></a><span class="st">            s.time_start,</span></span>
<span id="cb19-20"><a></a><span class="st">            s.time_end,</span></span>
<span id="cb19-21"><a></a><span class="st">            s.room,</span></span>
<span id="cb19-22"><a></a><span class="st">            s.semester,</span></span>
<span id="cb19-23"><a></a><span class="st">            e.distance</span></span>
<span id="cb19-24"><a></a><span class="st">        FROM course_embeddings e</span></span>
<span id="cb19-25"><a></a><span class="st">        JOIN courses c    ON e.course_id = c.id</span></span>
<span id="cb19-26"><a></a><span class="st">        JOIN instructors i ON c.instructor_id = i.id</span></span>
<span id="cb19-27"><a></a><span class="st">        JOIN schedules s   ON s.course_id = c.id</span></span>
<span id="cb19-28"><a></a><span class="st">        WHERE e.embedding MATCH ?</span></span>
<span id="cb19-29"><a></a><span class="st">          AND k = ?</span></span>
<span id="cb19-30"><a></a><span class="st">        ORDER BY e.distance</span></span>
<span id="cb19-31"><a></a><span class="st">    """</span>, (query_embedding.tobytes(), top_k)).fetchall()</span>
<span id="cb19-32"><a></a></span>
<span id="cb19-33"><a></a></span>
<span id="cb19-34"><a></a><span class="kw">def</span> rows_to_text(rows):</span>
<span id="cb19-35"><a></a>    <span class="cf">if</span> <span class="kw">not</span> rows:</span>
<span id="cb19-36"><a></a>        <span class="cf">return</span> <span class="st">"No results found."</span></span>
<span id="cb19-37"><a></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(rows, sqlite3.Row):</span>
<span id="cb19-38"><a></a>        rows <span class="op">=</span> [rows]</span>
<span id="cb19-39"><a></a>    <span class="cf">return</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>.join(</span>
<span id="cb19-40"><a></a>        <span class="st">"  "</span> <span class="op">+</span> <span class="st">", "</span>.join(<span class="ss">f"</span><span class="sc">{</span>k<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>row[k]<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> k <span class="kw">in</span> row.keys())</span>
<span id="cb19-41"><a></a>        <span class="cf">for</span> row <span class="kw">in</span> rows</span>
<span id="cb19-42"><a></a>    )</span>
<span id="cb19-43"><a></a></span>
<span id="cb19-44"><a></a></span>
<span id="cb19-45"><a></a><span class="kw">def</span> build_context(conn, user_query):</span>
<span id="cb19-46"><a></a>    rows <span class="op">=</span> search_courses(conn, user_query)</span>
<span id="cb19-47"><a></a>    <span class="cf">return</span> <span class="ss">f"Most relevant courses for the query:</span><span class="ch">\n</span><span class="sc">{</span>rows_to_text(rows)<span class="sc">}</span><span class="ss">"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</section>
<section id="how-rag-works-4" class="slide level2">
<h2>How RAG Works</h2>
<div class="quarto-embed-nb-cell" data-notebook="/home/runner/work/CS-394/CS-394/src/06/notebooks/rag.ipynb" data-notebook-title="RAG (Retrieval Augmented Generation)" data-notebook-cellid="call-with">
<div id="call-with" class="cell" data-execution_count="17">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a></a><span class="co"># Connect to the sqlite database</span></span>
<span id="cb20-2"><a></a>conn <span class="op">=</span> create_and_populate_db()</span>
<span id="cb20-3"><a></a></span>
<span id="cb20-4"><a></a><span class="co"># Query the database based on the user prompt</span></span>
<span id="cb20-5"><a></a>context <span class="op">=</span> build_context(conn, USER_PROMPT)</span>
<span id="cb20-6"><a></a></span>
<span id="cb20-7"><a></a><span class="co"># Create system prompt</span></span>
<span id="cb20-8"><a></a>SYSTEM_PROMPT <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb20-9"><a></a><span class="ss">You help students lookup course information. Here are the course details:</span></span>
<span id="cb20-10"><a></a></span>
<span id="cb20-11"><a></a><span class="ss">---COURSE INFORMATION---</span></span>
<span id="cb20-12"><a></a><span class="sc">{</span>context<span class="sc">}</span></span>
<span id="cb20-13"><a></a><span class="ss">---END COURSE INFORMATION---</span></span>
<span id="cb20-14"><a></a><span class="ss">"""</span></span>
<span id="cb20-15"><a></a></span>
<span id="cb20-16"><a></a><span class="co"># Query the model</span></span>
<span id="cb20-17"><a></a>response <span class="op">=</span> client.chat.completions.create(</span>
<span id="cb20-18"><a></a>    model<span class="op">=</span>MODEL,</span>
<span id="cb20-19"><a></a>    messages<span class="op">=</span>[</span>
<span id="cb20-20"><a></a>        {<span class="st">"role"</span>: <span class="st">"system"</span>, <span class="st">"content"</span>: SYSTEM_PROMPT},</span>
<span id="cb20-21"><a></a>        {<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: USER_PROMPT},</span>
<span id="cb20-22"><a></a>    ],</span>
<span id="cb20-23"><a></a>)</span>
<span id="cb20-24"><a></a>response.choices[<span class="dv">0</span>].message.content</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</section>
<section id="how-rag-works-5" class="slide level2">
<h2>How RAG Works</h2>
<ul>
<li class="fragment"><em>“Which courses teach about generative AI?”</em></li>
</ul>
</section>
<section id="how-rag-works-6" class="slide level2">
<h2>How RAG Works</h2>
<div class="quarto-embed-nb-cell" data-notebook="/home/runner/work/CS-394/CS-394/src/06/notebooks/rag.ipynb" data-notebook-title="RAG (Retrieval Augmented Generation)" data-notebook-cellid="call-with">
<div id="call-with" class="cell" data-execution_count="17">
<div class="cell-output cell-output-stdout">
<pre><code>Found existing database at '.data/course_catalog_rag.db'. Skipping creation.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>'The course that specifically teaches about generative AI is:\n\n**CS-394: How Generative AI Works**  \n- **Description**: Covers transformer architectures, large language models, prompt engineering, fine-tuning, and deployment. Includes hands-on work with open-source models.  \n- **Details**:  \n  - Credits: 3 | Level: Advanced  \n  - Instructor: Dr. Sarah Chen | [Contact](mailto:s.chen@university.edu)  \n  - Time: Tue/Thu 14:00–15:20 | Room: Lab 12  \n  - Semester: Spring 2026  \n\nThis course directly addresses generative AI concepts and techniques.\n'</code></pre>
</div>
</div>
</div>
</section></section>
<section>
<section id="hands-on-1" class="title-slide slide level1 center">
<h1>Hands-on</h1>
<p>Investigate text-to-sql.ipynb and rag.ipynb</p>
<p>Try different queries. Which work well on both?</p>
<p>Recreate the database with different data</p>
</section>
<section id="rag-chunking" class="slide level2">
<h2>RAG Chunking</h2>
<ul>
<li class="fragment">Large documents will require splitting (a.k.a. chunking)</li>
<li class="fragment">How documents are split before embedding has a major impact on retrieval quality
<ul>
<li class="fragment"><strong>Fixed-size:</strong> Split every N tokens, with optional overlap (e.g., 512 tokens, 50-token overlap). Simple and predictable, but can cut mid-sentence.</li>
<li class="fragment"><strong>Sentence/paragraph-aware:</strong> Split on natural boundaries (sentences, paragraphs). Better coherence, though chunk sizes will vary.</li>
<li class="fragment"><strong>Semantic chunking:</strong> Group sentences by embedding similarity, splitting where meaning shifts. Highest quality, but more complex.</li>
</ul></li>
</ul>
</section>
<section id="rag-for-photo-indexing" class="slide level2">
<h2>RAG for Photo Indexing</h2>
<ul>
<li class="fragment">RAG can also be used for photo/image indexing</li>
<li class="fragment">Documents can be created using VLMs (Vision Language Models)
<ul>
<li class="fragment">Descriptions from VLMs (together with photo metadata) can then be used for lookup</li>
<li class="fragment"><em>“Find me photos with two dogs next to the beach”</em></li>
<li class="fragment"><em>“Show me all my photos of sunsets in Hawaii”</em></li>
</ul></li>
</ul>
</section>
<section id="rag-for-photo-indexing-1" class="slide level2">
<h2>RAG for Photo Indexing</h2>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="diagrams/rag-photo.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img data-src="diagrams/rag-photo.svg" class="quarto-figure quarto-figure-center" width="600"></a></p>
</figure>
</div>
</section>
<section id="rag-databases" class="slide level2">
<h2>RAG Databases</h2>
<ul>
<li class="fragment">Extensions
<ul>
<li class="fragment"><strong>sqlite-vec:</strong> SQLite Extension (we’ve been using that!)</li>
<li class="fragment"><strong>pgvector:</strong> PostgreSQL extension</li>
</ul></li>
<li class="fragment">Libraries
<ul>
<li class="fragment"><strong>FAISS:</strong> (From Meta) In-memory vector index vs.&nbsp;database. Very fast.</li>
</ul></li>
</ul>
</section>
<section id="rag-databases-1" class="slide level2">
<h2>RAG Databases</h2>
<ul>
<li class="fragment"><strong>Pinecone:</strong> Popular commercial managed/cloud option.</li>
<li class="fragment"><strong>Qdrant:</strong> Open-source dedicated db, written in Rust.</li>
<li class="fragment"><strong>Milvus:</strong> Open-source. Heavier to operate, but can exceed a billion embeddings.</li>
</ul>
</section></section>
<section>
<section id="side-topic-evaluating-models" class="title-slide slide level1 center">
<h1>Side Topic: Evaluating Models</h1>

</section>
<section id="evaluating-models" class="slide level2">
<h2>Evaluating Models</h2>
<ul>
<li class="fragment">How do we know whether we are improving a model’s accuracy?
<ul>
<li class="fragment">Run evaluations (commonly known as “evals”)</li>
<li class="fragment">Allows us to benchmark progress, especially for fine-tuning</li>
<li class="fragment">We also want to know if performance has regressed (degraded) on certain tasks</li>
<li class="fragment">Evals also help grade models within certain domains (e.g., what is the SOTA model for math, coding, medical, law, etc.)</li>
</ul></li>
</ul>
</section>
<section id="evaluating-models-1" class="slide level2">
<h2>Evaluating Models</h2>
<ul>
<li class="fragment">How evals are created:
<ul>
<li class="fragment">Curated question sets: Experts write or gather questions based on ground truth answers</li>
<li class="fragment">Human-validated responses: For open-ended tasks (e.g., coding) human evaluators score model responses - or models are tested against validation logic (e.g., unit tests)</li>
<li class="fragment">Adversarial design: The best evals try to anticipate how models might “cheat” - e.g., avoiding questions in training data, including distractors and edge cases</li>
</ul></li>
</ul>
</section>
<section id="popular-evals-mmlu-pro" class="slide level2">
<h2>Popular Evals: MMLU Pro</h2>
<p><a href="https://huggingface.co/datasets/TIGER-Lab/MMLU-Pro" class="external" target="_blank">https://huggingface.co/datasets/TIGER-Lab/MMLU-Pro</a></p>
<ul>
<li class="fragment"><strong>What it tests:</strong> 12K questions across 14 subject areas that cover STEM, humanities, social sciences, and professional domains.
<ul>
<li class="fragment">Multiple-choice questions (10 options) testing both factual knowledge and reasoning across elementary to professional levels.</li>
</ul></li>
<li class="fragment"><strong>History:</strong> Original MMLU published in 2021 by Dan Hendrycks et al.&nbsp;
<ul>
<li class="fragment">MMLU-Pro created because models were plateauing on MMLU (hitting 85-90%+)</li>
<li class="fragment">Pro released in June 2024 by the TIGER-AI-Lab team and accepted at NeurIPS 2024</li>
</ul></li>
</ul>
</section>
<section id="popular-evals-gpqa" class="slide level2">
<h2>Popular Evals: GPQA</h2>
<p><a href="https://huggingface.co/datasets/Idavidrein/gpqa" class="external" target="_blank">https://huggingface.co/datasets/Idavidrein/gpqa</a></p>
<ul>
<li class="fragment"><strong>What it tests:</strong> Graduate/PhD-level scientific reasoning in biology, physics, and chemistry through multiple-choice questions
<ul>
<li class="fragment">Require deep domain understanding, not just fact recall</li>
<li class="fragment">Cannot be solved by web search (the “Google-proof” property)</li>
<li class="fragment">Test genuine conceptual reasoning and problem-solving</li>
</ul></li>
<li class="fragment"><strong>History:</strong>
<ul>
<li class="fragment">Created Nov 2023 by David Rein et al.&nbsp;(includes researchers from NYU, Anthropic, and other institutions)</li>
</ul></li>
</ul>
</section>
<section id="popular-evals-swe-bench" class="slide level2">
<h2>Popular Evals: SWE-Bench</h2>
<p><a href="https://www.swebench.com/" class="external" target="_blank">https://www.swebench.com/</a></p>
<ul>
<li class="fragment"><strong>What it tests:</strong> AI systems’ ability to solve real-world software engineering tasks by resolving actual GitHub issues from popular open-source Python repositories</li>
<li class="fragment"><strong>History:</strong> Created: 2023 by Princeton NLP group (Carlos E. Jimenez et al.)
<ul>
<li class="fragment">Original dataset was 2,294 GitHub issues from 12 popular Python repositories (Django, scikit-learn, Flask, Matplotlib, Requests, SymPy, pytest, Sphinx, etc.)</li>
<li class="fragment">Three major variants: Lite, Verified, and Pro</li>
<li class="fragment">Microsoft also publishes a “Live” version with monthly curated updates</li>
</ul></li>
</ul>
</section>
<section id="popular-evals-hle" class="slide level2">
<h2>Popular Evals: HLE</h2>
<p><a href="https://huggingface.co/datasets/cais/hle" class="external" target="_blank">https://huggingface.co/datasets/cais/hle</a></p>
<ul>
<li class="fragment"><strong>What it tests:</strong> 2,500 expert-level questions across dozens of subjects, including mathematics, humanities, and the natural sciences.
<ul>
<li class="fragment">HLE is developed globally by subject-matter experts and consists of multiple-choice and short-answer questions suitable for automated grading.</li>
<li class="fragment">Require multimodal, multi-step reasoning rather than pattern matching or recall</li>
<li class="fragment">Be “Google-proof” (can’t be quickly answered by web search)</li>
</ul></li>
<li class="fragment"><strong>History:</strong> Created in late 2024 by the Center for AI Safety (CAIS) and Scale AI
<ul>
<li class="fragment">Led by: Dan Hendrycks (who also created MMLU and MATH benchmarks)</li>
</ul></li>
</ul>
</section>
<section id="challenges-with-evals" class="slide level2">
<h2>Challenges With Evals</h2>
<ul>
<li class="fragment">Dataset contamination
<ul>
<li class="fragment">Many popular benchmarks (MMLU, HumanEval) have been around for years and “leaked” into training data</li>
<li class="fragment">Models can achieve a high score by memorizing the questions/answers vs.&nbsp;true reasoning</li>
</ul></li>
<li class="fragment">Gaming the benchmark
<ul>
<li class="fragment">Researchers may optimize models specifically for benchmark performance without improving general capability - also known as “teaching to the test”</li>
</ul></li>
</ul>
</section>
<section id="challenges-with-evals-1" class="slide level2">
<h2>Challenges With Evals</h2>
<ul>
<li class="fragment">Synthetic vs.&nbsp;human generated problems
<ul>
<li class="fragment">Many evals use multiple-choice, clean, well formatted problems.</li>
<li class="fragment">Real users index towards more open-ended questions, which may have typos, missing context, and other edge cases.</li>
</ul></li>
<li class="fragment">Bias and fairness
<ul>
<li class="fragment">Standard evals rarely measure performance across demographics - a model might excel on average, but fail for under-represented groups or languages.</li>
</ul></li>
</ul>
</section>
<section id="whats-next-for-evals" class="slide level2">
<h2>What’s Next For Evals?</h2>
<ul>
<li class="fragment"><strong>Agentic and multi-step workflows:</strong> Moving beyond single-question tests to measure performance on longer tasks like research, multi-file codebases, and customer support conversations</li>
<li class="fragment"><strong>Contamination-resistant design:</strong> Hugging Face’s Benchmarks and dynamic benchmarks that refresh regularly (like SWE-Bench Live) or generate novel questions programmatically to avoid training data leakage</li>
<li class="fragment"><strong>Process evaluation over outcomes:</strong> Testing <em>how</em> models reason, not just final answers — can the model self-correct, identify its mistakes, and explain its reasoning?</li>
</ul>
</section></section>
<section>
<section id="fine-tuning" class="title-slide slide level1 center">
<h1>Fine-tuning</h1>

</section>
<section id="fine-tuning-1" class="slide level2">
<h2>Fine-tuning</h2>
<ul>
<li class="fragment">Prompt engineering, using thinking models, and context injection (RAG) can help improve the output and accuracy of models</li>
<li class="fragment">However, sometimes you need the model to have more consistency in its style, structure, or behavior</li>
<li class="fragment">Enter fine-tuning…</li>
</ul>
</section>
<section id="fine-tuning-2" class="slide level2">
<h2>Fine-tuning</h2>
<ul>
<li class="fragment">Fine-tuning is the process of taking a pre-trained model and continuing to train it on a smaller, task-specific dataset using curated examples</li>
<li class="fragment">This allows it to adapt its general capabilities toward a particular <strong>style</strong>, <strong>structure</strong> or <strong>behavior</strong> without learning from scratch</li>
</ul>
</section>
<section id="fine-tuning-3" class="slide level2">
<h2>Fine-tuning</h2>
<ul>
<li class="fragment">Examples
<ul>
<li class="fragment"><strong>Style:</strong> Adopting a different voice at scale: Speak to students using “Hinglish” at a 5th grade level</li>
<li class="fragment"><strong>Structure</strong>: Generating outputs in a precise format: Player movement instructions in a game, in JSON format</li>
<li class="fragment"><strong>Behavior</strong>: Always refuse off-topic questions and redirect to the subject matter (guardrail)</li>
</ul></li>
</ul>
</section>
<section id="history-of-fine-tuning" class="slide level2">
<h2>History of Fine-tuning</h2>
<ul>
<li class="fragment"><strong>2010s:</strong> Fine-tuning became prevalent in computer vision (e.g., ImageNet-trained CNNs for medical)</li>
<li class="fragment"><strong>2018:</strong> BERT demonstrated that a language model could be fine-tuned for sentiment, Q&amp;A, and classification</li>
<li class="fragment"><strong>2022:</strong> InstructGPT fine-tuning on human-curated instruction-response pairs</li>
<li class="fragment"><strong>Today:</strong> Very popular technique for adapting trained models to different use cases</li>
</ul>
</section>
<section id="when-to-pick-what" class="slide level2">
<h2>When To Pick What</h2>
<ul>
<li class="fragment">Prompt Engineering shapes how the model responds to input</li>
<li class="fragment">Context Injection (RAG) augments the context with data</li>
<li class="fragment">Fine-tuning reshapes the model itself</li>
<li class="fragment">(A combination of all three are often used together)</li>
</ul>
</section>
<section id="sidebar-can-we-train-models-from-scratch" class="slide level2">
<h2>Sidebar: Can We Train Models From Scratch?</h2>
<ul>
<li class="fragment"><a href="https://github.com/karpathy/nanochat" class="external" target="_blank">NanoChat</a> shows that it’s possible
<ul>
<li class="fragment">60x faster and 652x cheaper than original GPT-2 in 2019</li>
</ul></li>
<li class="fragment">But you may not have the data nor the GPU compute to build a capable model
<ul>
<li class="fragment">Trained on <a href="https://huggingface.co/datasets/HuggingFaceFW/fineweb-edu" class="external" target="_blank">fineweb-edu</a></li>
<li class="fragment">GPT-2 level: 3 hours on an 8xH100 GPU</li>
</ul></li>
</ul>
</section></section>
<section>
<section id="generating-training-data" class="title-slide slide level1 center">
<h1>Generating Training Data</h1>

</section>
<section id="generating-training-data-1" class="slide level2">
<h2>Generating Training Data</h2>
<ul>
<li class="fragment">Before we can fine-tune a model, we need to generate training data
<ul>
<li class="fragment">Data are conversations or input/output pairs that demonstrate <strong>style</strong>, <strong>structure</strong>, or <strong>behavior</strong> you want the model to adopt</li>
</ul></li>
</ul>
</section>
<section id="generating-training-data-2" class="slide level2">
<h2>Generating Training Data</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb23"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb23-1"><a></a><span class="fu">{</span><span class="dt">"messages"</span><span class="fu">:</span> <span class="ot">[</span><span class="fu">{</span><span class="dt">"role"</span><span class="fu">:</span> <span class="st">"user"</span><span class="fu">,</span> <span class="dt">"content"</span><span class="fu">:</span> <span class="st">"s = </span><span class="ch">\"</span><span class="st">Hello</span><span class="ch">\\</span><span class="st">nWorld</span><span class="ch">\"\n</span><span class="st">print(s)</span><span class="ch">\n</span><span class="st">"</span><span class="fu">}</span><span class="ot">,</span> <span class="fu">{</span><span class="dt">"role"</span><span class="fu">:</span> <span class="st">"assistant"</span><span class="fu">,</span> <span class="dt">"content"</span><span class="fu">:</span> <span class="st">"The code defines a string that contains the escape sequence </span><span class="ch">\\</span><span class="st">n, which tells Python to start a new line when the string is displayed. When you run the print statement, </span><span class="ch">\"</span><span class="st">Hello</span><span class="ch">\"</span><span class="st"> appears on one line and </span><span class="ch">\"</span><span class="st">World</span><span class="ch">\"</span><span class="st"> appears on the next line, just like pressing Enter moves the cursor down in a text editor.</span><span class="ch">\n\n</span><span class="st">Imagine you are writing a story on a typewriter. When you finish a line, you press the </span><span class="ch">\u201c</span><span class="st">Enter</span><span class="ch">\u201d</span><span class="st"> key to move to the next line and continue typing. The </span><span class="ch">\\</span><span class="st">n character works the same way for strings in Python, signaling that the following text should start on a new line."</span><span class="fu">}</span><span class="ot">]</span><span class="fu">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="generating-training-data-3" class="slide level2">
<h2>Generating Training Data</h2>
<ul>
<li class="fragment">Three datasets
<ul>
<li class="fragment"><strong>Training set:</strong> What the model will learn from. Largest portion, about 70-80% of total data</li>
<li class="fragment"><strong>Validation set:</strong> Separate dataset, used to monitor how well the model is generalizing. About 10-15%.</li>
<li class="fragment"><strong>Test set:</strong> Separate dataset, provides an unbiased final measure of performance after training. About 10-15%</li>
</ul></li>
</ul>
</section>
<section id="generating-training-data-4" class="slide level2">
<h2>Generating Training Data</h2>
<ul>
<li class="fragment">Diversity of training data
<ul>
<li class="fragment">Needs to cover the range of inputs that the model will encounter in production.</li>
<li class="fragment">A model trained only on short questions will struggle when users ask anything more complex</li>
<li class="fragment">Datasets should have different dimensions</li>
</ul></li>
</ul>
</section>
<section id="generating-training-data-5" class="slide level2">
<h2>Generating Training Data</h2>
<ul>
<li class="fragment">Diversity dimensions
<ul>
<li class="fragment">Topics (areas, sub-domains)</li>
<li class="fragment">Audience (e.g., school grade)</li>
<li class="fragment">Length (e.g., short, med, long)</li>
<li class="fragment">Formats (e.g., script vs.&nbsp;romanized)</li>
<li class="fragment">Conversation turns (single / multi)</li>
<li class="fragment">Negative answers (e.g., if implementing safety)</li>
</ul></li>
<li class="fragment">Each of these can be weighted (e.g., 60% short, 20% med, 20% long)</li>
</ul>
</section>
<section id="generating-training-data-6" class="slide level2">
<h2>Generating Training Data</h2>
<ul>
<li class="fragment">How much data do you need? It depends :)</li>
<li class="fragment">Behaviour and style shifts: 50-500 high quality examples</li>
<li class="fragment">Multi-turn dialogue: 1K-10K examples</li>
<li class="fragment">Smaller models often need more examples</li>
<li class="fragment">Optimal dataset size is often discovered during training</li>
</ul>
</section>
<section id="generating-training-data-7" class="slide level2">
<h2>Generating Training Data</h2>
<ul>
<li class="fragment">Dataset Format
<ul>
<li class="fragment">Typically JSON Lines (jsonl) - JSON objects separated with newline</li>
</ul></li>
<li class="fragment">Converted to Hugging Face Datasets (and uploaded)</li>
<li class="fragment">During training, these get converted to the chat template/format used by the model</li>
</ul>
</section>
<section id="generating-training-data-8" class="slide level2">
<h2>Generating Training Data</h2>
<ul>
<li class="fragment">How do we generate this data?
<ul>
<li class="fragment">Create the file by hand!</li>
<li class="fragment">Generate <strong>synthetic data</strong> from a more capable model (and review for quality)</li>
<li class="fragment">Known as “data distillation”</li>
</ul></li>
<li class="fragment">Synthetic Data
<ul>
<li class="fragment"><em>“Generate n examples of students asking their teacher a geography question”</em></li>
<li class="fragment">Often use structured outputs to map to jsonl conversational format</li>
</ul></li>
</ul>
</section></section>
<section id="demo" class="title-slide slide level1 center">
<h1>Demo</h1>
<p>Synthetic data generation using the generate-synthetic.ipynb notebook</p>
</section>

<section>
<section id="looking-ahead" class="title-slide slide level1 center">
<h1>Looking Ahead</h1>

</section>
<section id="looking-ahead-1" class="slide level2">
<h2>Looking Ahead</h2>
<ul>
<li class="fragment"><a href="https://simonguest.github.io/CS-394/src/06/assignment.html" class="external" target="_blank">This week’s assignment!</a></li>
<li class="fragment">Use your generated synthetic data to fine-tune a small model</li>
<li class="fragment">Use W&amp;B (Weights and Biases) to observe parameters during the training run</li>
<li class="fragment">Understand and create a model card, upload your model to Hugging Face and share</li>
</ul>
</section></section>
<section>
<section id="references" class="title-slide slide level1 center">
<h1>References</h1>

</section>
<section id="references-1" class="slide level2 smaller scrollable">
<h2>References</h2>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-lewis2020retrieval" class="csl-entry" role="listitem">
Lewis, Patrick, Ethan Perez, Aleksandra Piktus, Fabio Petroni, Vladimir Karpukhin, Naman Goyal, Heinrich Küttler, et al. 2020. <span>“Retrieval-Augmented Generation for Knowledge-Intensive NLP Tasks.”</span> <em>Advances in Neural Information Processing Systems</em> 33: 9459–74. <a href="https://arxiv.org/abs/2005.11401">https://arxiv.org/abs/2005.11401</a>.
</div>
<div id="ref-wei2022chain" class="csl-entry" role="listitem">
Wei, Jason, Xuezhi Wang, Dale Schuurmans, Maarten Bosma, Brian Ichter, Fei Xia, Ed H. Chi, Quoc V. Le, and Denny Zhou. 2022. <span>“Chain-of-Thought Prompting Elicits Reasoning in Large Language Models.”</span> <em>Advances in Neural Information Processing Systems</em> 35: 24824–37. <a href="https://arxiv.org/abs/2201.11903">https://arxiv.org/abs/2201.11903</a>.
</div>
</div>
</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="../../theme/logos/DigiPen_RGB_Red.png" class="slide-logo"></p>
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.15,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
          const outerScaffold = trigger.parentElement.cloneNode(true);
          const codeEl = outerScaffold.querySelector('code');
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp("https:\/\/simonguest\.github\.io\/CS-394\/");
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    <script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
    (function() {
      let previousOnload = window.onload;
      window.onload = () => {
        if (previousOnload) {
          previousOnload();
        }
        lightboxQuarto.on('slide_before_load', (data) => {
          const { slideIndex, slideNode, slideConfig, player, trigger } = data;
          const href = trigger.getAttribute('href');
          if (href !== null) {
            const imgEl = window.document.querySelector(`a[href="${href}"] img`);
            if (imgEl !== null) {
              const srcAttr = imgEl.getAttribute("src");
              if (srcAttr && srcAttr.startsWith("data:")) {
                slideConfig.href = srcAttr;
              }
            }
          } 
        });
      
        lightboxQuarto.on('slide_after_load', (data) => {
          const { slideIndex, slideNode, slideConfig, player, trigger } = data;
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(slideNode);
          }
        });
      
      };
      
    })();
              </script>
    

</body></html>